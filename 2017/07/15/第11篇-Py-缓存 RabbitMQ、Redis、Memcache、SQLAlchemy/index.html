<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="python," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="MemcachedMemcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。
Memcached安装和基">
<meta property="og:type" content="article">
<meta property="og:title" content="第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy">
<meta property="og:url" content="http://yoursite.com/2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/index.html">
<meta property="og:site_name" content="Yaro's Notes">
<meta property="og:description" content="MemcachedMemcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。
Memcached安装和基">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699586b67bd.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/596998070c641.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/5969991be606a.jpg">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699c1eb5cbc.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699d9cba93d.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699df4b893d.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699e3d62436.png">
<meta property="og:image" content="https://i.loli.net/2017/07/15/59699f5e30338.png">
<meta property="og:updated_time" content="2017-07-15T15:39:16.407Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy">
<meta name="twitter:description" content="MemcachedMemcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。
Memcached安装和基">
<meta name="twitter:image" content="https://i.loli.net/2017/07/15/59699586b67bd.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/"/>





  <title> 第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy | Yaro's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Yaro's Notes</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录/备忘/练手</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Yaro">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://7u2o1q.com1.z0.glb.clouddn.com/Yaro%E5%A4%B4%E5%83%8F1.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Yaro's Notes">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Yaro's Notes" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-15T15:36:47+08:00">
                2017-07-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><p>Memcached 是一个高性能的分布式内存对象缓存系统，用于动态Web应用以减轻数据库负载。它通过在内存中缓存数据和对象来减少读取数据库的次数，从而提高动态、数据库驱动网站的速度。Memcached基于一个存储键/值对的hashmap。其守护进程（daemon ）是用C写的，但是客户端可以用任何语言来编写，并通过memcached协议与守护进程通信。</p>
<h4 id="Memcached安装和基本使用"><a href="#Memcached安装和基本使用" class="headerlink" title="Memcached安装和基本使用"></a>Memcached安装和基本使用</h4><h5 id="Memcached安装："><a href="#Memcached安装：" class="headerlink" title="Memcached安装："></a>Memcached安装：</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">wget http://memcached.org/latest</div><div class="line">tar -zxvf memcached-1.x.x.tar.gz</div><div class="line"><span class="built_in">cd</span> memcached-1.x.x</div><div class="line">./configure &amp;&amp; make &amp;&amp; make <span class="built_in">test</span> &amp;&amp; sudo make install</div><div class="line"> </div><div class="line">PS：依赖libevent</div><div class="line">       yum install libevent-devel</div><div class="line">       apt-get install libevent-dev</div></pre></td></tr></table></figure>
<a id="more"></a>
<h5 id="启动Memcached"><a href="#启动Memcached" class="headerlink" title="启动Memcached"></a>启动Memcached</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">memcached -d -m 10    -u root -l 10.211.55.4 -p 12000 -c 256 -P /tmp/memcached.pid</div><div class="line"> </div><div class="line">参数说明:</div><div class="line">    -d 是启动一个守护进程</div><div class="line">    -m 是分配给Memcache使用的内存数量，单位是MB</div><div class="line">    -u 是运行Memcache的用户</div><div class="line">    -l 是监听的服务器IP地址</div><div class="line">    -p 是设置Memcache监听的端口,最好是1024以上的端口</div><div class="line">    -c 选项是最大运行的并发连接数，默认是1024，按照你服务器的负载量来设定</div><div class="line">    -P 是设置保存Memcache的pid文件</div></pre></td></tr></table></figure>
<h5 id="Memcached命令"><a href="#Memcached命令" class="headerlink" title="Memcached命令"></a>Memcached命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">存储命令: set/add/replace/append/prepend/cas</div><div class="line">获取命令: get/gets</div><div class="line">其他命令: delete/stats..</div></pre></td></tr></table></figure>
<h4 id="Python操作Memcached"><a href="#Python操作Memcached" class="headerlink" title="Python操作Memcached"></a>Python操作Memcached</h4><h5 id="安装API"><a href="#安装API" class="headerlink" title="安装API"></a>安装API</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">python操作Memcached使用Python-memcached模块</div><div class="line">下载安装：https://pypi.python.org/pypi/python-memcached</div></pre></td></tr></table></figure>
<h5 id="1、第一次操作"><a href="#1、第一次操作" class="headerlink" title="1、第一次操作"></a>1、第一次操作</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line">mc.set(<span class="string">"foo"</span>, <span class="string">"bar"</span>)</div><div class="line">ret = mc.get(<span class="string">'foo'</span>)</div><div class="line"><span class="keyword">print</span> ret</div></pre></td></tr></table></figure>
<p>Ps：debug = True 表示运行出现错误时，现实错误信息，上线后移除该参数。</p>
<h5 id="2、天生支持集群"><a href="#2、天生支持集群" class="headerlink" title="2、天生支持集群"></a>2、天生支持集群</h5><p>python-memcached模块原生支持集群操作，其原理是在内存维护一个主机列表，且集群中主机的权重值和主机在列表中重复出现的次数成正比</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">     主机    权重</div><div class="line">    1.1.1.1   1</div><div class="line">    1.1.1.2   2</div><div class="line">    1.1.1.3   1</div><div class="line"> </div><div class="line">那么在内存中主机列表为：</div><div class="line">    host_list = [&quot;1.1.1.1&quot;, &quot;1.1.1.2&quot;, &quot;1.1.1.2&quot;, &quot;1.1.1.3&quot;, ]</div></pre></td></tr></table></figure>
<p>如果用户根据如果要在内存中创建一个键值对（如：k1 = “v1”），那么要执行一下步骤：</p>
<ul>
<li>根据算法将 k1 转换成一个数字</li>
<li>将数字和主机列表长度求余数，得到一个值 N（ 0 &lt;= N &lt; 列表长度 ）</li>
<li>在主机列表中根据 第2步得到的值为索引获取主机，例如：host_list[N]</li>
<li>连接 将第3步中获取的主机，将 k1 = “v1” 放置在该服务器的内存中</li>
</ul>
<p>代码实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mc = memcache.Client([(<span class="string">'1.1.1.1:12000'</span>, <span class="number">1</span>), (<span class="string">'1.1.1.2:12000'</span>, <span class="number">2</span>), (<span class="string">'1.1.1.3:12000'</span>, <span class="number">1</span>)], debug=<span class="keyword">True</span>)</div><div class="line">mc.set(<span class="string">'k1'</span>, <span class="string">'v1'</span>)</div></pre></td></tr></table></figure>
<h5 id="3、add"><a href="#3、add" class="headerlink" title="3、add"></a>3、add</h5><p>添加一条键值对，如果已经存在的 key，重复执行add操作异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line">mc.add(<span class="string">'k1'</span>, <span class="string">'v1'</span>)</div><div class="line"><span class="comment"># mc.add('k1', 'v2') # 报错，对已经存在的key重复添加，失败！！！</span></div></pre></td></tr></table></figure>
<h5 id="4、replace"><a href="#4、replace" class="headerlink" title="4、replace"></a>4、replace</h5><p>replace 修改某个key的值，如果key不存在，则异常</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line"><span class="comment"># 如果memcache中存在kkkk，则替换成功，否则一场</span></div><div class="line">mc.replace(<span class="string">'kkkk'</span>,<span class="string">'999'</span>)</div></pre></td></tr></table></figure>
<h5 id="5、set-和-set-multi"><a href="#5、set-和-set-multi" class="headerlink" title="5、set 和 set_multi"></a>5、set 和 set_multi</h5><p>set            设置一个键值对，如果key不存在，则创建，如果key存在，则修改<br>set_multi   设置多个键值对，如果key不存在，则创建，如果key存在，则修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line">mc.set(<span class="string">'key0'</span>, <span class="string">'wupeiqi'</span>)</div><div class="line">mc.set_multi(&#123;<span class="string">'key1'</span>: <span class="string">'val1'</span>, <span class="string">'key2'</span>: <span class="string">'val2'</span>&#125;)</div></pre></td></tr></table></figure>
<h5 id="6、delete-和-delete-multi"><a href="#6、delete-和-delete-multi" class="headerlink" title="6、delete 和 delete_multi"></a>6、delete 和 delete_multi</h5><p>delete             在Memcached中删除指定的一个键值对<br>delete_multi    在Memcached中删除指定的多个键值对</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">mc.delete(<span class="string">'key0'</span>)</div><div class="line">mc.delete_multi([<span class="string">'key1'</span>, <span class="string">'key2'</span>])</div></pre></td></tr></table></figure>
<h5 id="7、get-和-get-multi"><a href="#7、get-和-get-multi" class="headerlink" title="7、get 和 get_multi"></a>7、get 和 get_multi</h5><p>get            获取一个键值对<br>get_multi   获取多一个键值对</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">val = mc.get(<span class="string">'key0'</span>)</div><div class="line">item_dict = mc.get_multi([<span class="string">"key1"</span>, <span class="string">"key2"</span>, <span class="string">"key3"</span>])</div></pre></td></tr></table></figure>
<h5 id="8、append-和-prepend"><a href="#8、append-和-prepend" class="headerlink" title="8、append 和 prepend"></a>8、append 和 prepend</h5><p>append    修改指定key的值，在该值 后面 追加内容<br>prepend   修改指定key的值，在该值 前面 插入内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line"><span class="comment"># k1 = "v1"</span></div><div class="line"> </div><div class="line">mc.append(<span class="string">'k1'</span>, <span class="string">'after'</span>)</div><div class="line"><span class="comment"># k1 = "v1after"</span></div><div class="line"> </div><div class="line">mc.prepend(<span class="string">'k1'</span>, <span class="string">'before'</span>)</div><div class="line"><span class="comment"># k1 = "beforev1after"</span></div></pre></td></tr></table></figure>
<h5 id="9、decr-和-incr"><a href="#9、decr-和-incr" class="headerlink" title="9、decr 和 incr　　"></a>9、decr 和 incr　　</h5><p>incr  自增，将Memcached中的某一个值增加 N （ N默认为1 ）<br>decr 自减，将Memcached中的某一个值减少 N （ N默认为1 ）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line"> </div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>)</div><div class="line">mc.set(<span class="string">'k1'</span>, <span class="string">'777'</span>)</div><div class="line"> </div><div class="line">mc.incr(<span class="string">'k1'</span>)</div><div class="line"><span class="comment"># k1 = 778</span></div><div class="line"> </div><div class="line">mc.incr(<span class="string">'k1'</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># k1 = 788</span></div><div class="line"> </div><div class="line">mc.decr(<span class="string">'k1'</span>)</div><div class="line"><span class="comment"># k1 = 787</span></div><div class="line"> </div><div class="line">mc.decr(<span class="string">'k1'</span>, <span class="number">10</span>)</div><div class="line"><span class="comment"># k1 = 777</span></div></pre></td></tr></table></figure>
<h5 id="10、gets-和-cas"><a href="#10、gets-和-cas" class="headerlink" title="10、gets 和 cas"></a>10、gets 和 cas</h5><p>如商城商品剩余个数，假设改值保存在memcache中，product_count = 900<br>A用户刷新页面从memcache中读取到product_count = 900<br>B用户刷新页面从memcache中读取到product_count = 900</p>
<p>如果A、B用户均购买商品</p>
<p>A用户修改商品剩余个数 product_count＝899<br>B用户修改商品剩余个数 product_count＝899</p>
<p>如此一来缓存内的数据便不在正确，两个用户购买商品后，商品剩余还是 899<br>如果使用python的set和get来操作以上过程，那么程序就会如上述所示情况！</p>
<p>如果想要避免此情况的发生，只要使用 gets 和 cas 即可，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> memcache</div><div class="line">mc = memcache.Client([<span class="string">'10.211.55.4:12000'</span>], debug=<span class="keyword">True</span>, cache_cas=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">v = mc.gets(<span class="string">'product_count'</span>)</div><div class="line"><span class="comment"># ...</span></div><div class="line"><span class="comment"># 如果有人在gets之后和cas之前修改了product_count，那么，下面的设置将会执行失败，剖出异常，从而避免非正常数据的产生</span></div><div class="line">mc.cas(<span class="string">'product_count'</span>, <span class="string">"899"</span>)</div></pre></td></tr></table></figure>
<p>Ps：本质上每次执行gets时，会从memcache中获取一个自增的数字，通过cas去修改gets的值时，会携带之前获取的自增值和memcache中的自增值进行比较，如果相等，则可以提交，如果不想等，那表示在gets和cas执行之间，又有其他人执行了gets（获取了缓冲的指定值）， 如此一来有可能出现非正常数据，则不允许修改。</p>
<p><a href="http://www.oschina.net/news/26691/memcached-timeout" target="_blank" rel="external">Memcached 真的过时了吗？</a></p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p>redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上，redis支持各种不同方式的排序。与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<h4 id="一、Redis安装和基本使用"><a href="#一、Redis安装和基本使用" class="headerlink" title="一、Redis安装和基本使用"></a>一、Redis安装和基本使用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">wget http://download.redis.io/releases/redis-3.0.6.tar.gz</div><div class="line">tar xzf redis-3.0.6.tar.gz</div><div class="line"><span class="built_in">cd</span> redis-3.0.6</div><div class="line">make</div><div class="line"></div><div class="line"><span class="comment">#启动服务端</span></div><div class="line">src/redis-server</div><div class="line"></div><div class="line"><span class="comment">#启动客户端</span></div><div class="line">src/redis-cli</div><div class="line">redis&gt; <span class="built_in">set</span> foo bar</div><div class="line">OK</div><div class="line">redis&gt; get foo</div><div class="line"><span class="string">"bar"</span></div></pre></td></tr></table></figure>
<h4 id="二、Python操作Redis"><a href="#二、Python操作Redis" class="headerlink" title="二、Python操作Redis"></a>二、Python操作Redis</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装</span></div><div class="line">sudo pip install redis</div><div class="line">or</div><div class="line">sudo easy_install redis</div><div class="line">or</div><div class="line">源码安装</div><div class="line"> </div><div class="line">详见：https://github.com/WoLpH/redis-py</div></pre></td></tr></table></figure>
<p>API使用</p>
<p>redis-py 的API的使用可以分类为：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">- </span>连接方式</div><div class="line"><span class="bullet">- </span>连接池</div><div class="line"><span class="bullet">- </span>操作</div><div class="line">  - String 操作</div><div class="line">  - Hash 操作</div><div class="line">  - List 操作</div><div class="line">  - Set 操作</div><div class="line">  - Sort Set 操作</div><div class="line"><span class="bullet">- </span>管道</div><div class="line"><span class="bullet">- </span>发布订阅</div></pre></td></tr></table></figure>
<h5 id="1、操作模式"><a href="#1、操作模式" class="headerlink" title="1、操作模式"></a>1、操作模式</h5><p>redis-py提供两个类Redis和StrictRedis用于实现Redis的命令，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">r = redis.Redis(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</div><div class="line">r.set(<span class="string">'foo'</span>, <span class="string">'Bar'</span>)</div><div class="line"><span class="keyword">print</span> r.get(<span class="string">'foo'</span>)</div></pre></td></tr></table></figure>
<h5 id="2、连接池"><a href="#2、连接池" class="headerlink" title="2、连接池"></a>2、连接池</h5><p>redis-py使用connection pool来管理对一个redis server的所有连接，避免每次建立、释放连接的开销。默认，每个Redis实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数Redis，这样就可以实现多个Redis实例共享一个连接池。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line">r.set(<span class="string">'foo'</span>, <span class="string">'Bar'</span>)</div><div class="line"><span class="keyword">print</span> r.get(<span class="string">'foo'</span>)</div></pre></td></tr></table></figure>
<h5 id="3、操作"><a href="#3、操作" class="headerlink" title="3、操作"></a>3、操作</h5><h6 id="String操作"><a href="#String操作" class="headerlink" title="String操作"></a>String操作</h6><p>redis中的String在在内存中按照一个name对应一个value来存储。如图：</p>
<p><img src="https://i.loli.net/2017/07/15/59699586b67bd.png" width="400px"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div></pre></td><td class="code"><pre><div class="line">set(name, value, ex=<span class="keyword">None</span>, px=<span class="keyword">None</span>, nx=<span class="keyword">False</span>, xx=<span class="keyword">False</span>)</div><div class="line"><span class="comment">#在Redis中设置值，默认，不存在则创建，存在则修改</span></div><div class="line"><span class="comment">#参数：</span></div><div class="line"><span class="comment">#     ex，过期时间（秒）</span></div><div class="line"><span class="comment">#     px，过期时间（毫秒）</span></div><div class="line"><span class="comment">#     nx，如果设置为True，则只有name不存在时，当前set操作才执行</span></div><div class="line"><span class="comment">#     xx，如果设置为True，则只有name存在时，岗前set操作才执行</span></div><div class="line"></div><div class="line">setnx(name, value)</div><div class="line"><span class="comment">#设置值，只有name不存在时，执行设置操作（添加）</span></div><div class="line"></div><div class="line">setex(name, value, time)</div><div class="line"><span class="comment"># 设置值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># time，过期时间（数字秒 或 timedelta对象）</span></div><div class="line"></div><div class="line">psetex(name, time_ms, value)</div><div class="line"><span class="comment"># 设置值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># time_ms，过期时间（数字毫秒 或 timedelta对象）</span></div><div class="line"></div><div class="line">mset(*args, **kwargs)</div><div class="line"><span class="comment">#批量设置值</span></div><div class="line"><span class="comment">#如：</span></div><div class="line">    mset(k1=<span class="string">'v1'</span>, k2=<span class="string">'v2'</span>)</div><div class="line"><span class="comment">#    或</span></div><div class="line">    mget(&#123;<span class="string">'k1'</span>: <span class="string">'v1'</span>, <span class="string">'k2'</span>: <span class="string">'v2'</span>&#125;)</div><div class="line"></div><div class="line">get(name)</div><div class="line"><span class="comment">#获取值</span></div><div class="line"></div><div class="line">mget(keys, *args)</div><div class="line"><span class="comment">#批量获取</span></div><div class="line"><span class="comment">#如：</span></div><div class="line">    mget(<span class="string">'ylr'</span>, <span class="string">'wupeiqi'</span>)</div><div class="line"><span class="comment">#    或</span></div><div class="line">    r.mget([<span class="string">'ylr'</span>, <span class="string">'wupeiqi'</span>])</div><div class="line"></div><div class="line">getset(name, value)</div><div class="line"><span class="comment">#设置新值并获取原来的值</span></div><div class="line"></div><div class="line">getrange(key, start, end)</div><div class="line"><span class="comment"># 获取子序列（根据字节获取，非字符）</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，Redis 的 name</span></div><div class="line">    <span class="comment"># start，起始位置（字节）</span></div><div class="line">    <span class="comment"># end，结束位置（字节）</span></div><div class="line"><span class="comment"># 如： "武沛齐" ，0-3表示 "武"</span></div><div class="line"></div><div class="line">setrange(name, offset, value)</div><div class="line"><span class="comment"># 修改字符串内容，从指定字符串索引开始向后替换（新值太长时，则向后添加）</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># offset，字符串的索引，字节（一个汉字三个字节）</span></div><div class="line">    <span class="comment"># value，要设置的值</span></div><div class="line"></div><div class="line"></div><div class="line">setbit(name, offset, value)</div><div class="line"><span class="comment"># 对name对应值的二进制表示的位进行操作</span></div><div class="line"> </div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># offset，位的索引（将值变换成二进制后再进行索引）</span></div><div class="line">    <span class="comment"># value，值只能是 1 或 0</span></div><div class="line"> </div><div class="line"><span class="comment"># 注：如果在Redis中有一个对应： n1 = "foo"，</span></div><div class="line"><span class="comment">#     那么字符串foo的二进制表示为：01100110 01101111 01101111</span></div><div class="line"><span class="comment">#     所以，如果执行 setbit('n1', 7, 1)，则就会将第7位设置为1，</span></div><div class="line"><span class="comment">#     那么最终二进制则变成 01100111 01101111 01101111，即："goo"</span></div><div class="line"> </div><div class="line"><span class="comment"># 扩展，转换二进制表示：</span></div><div class="line"> </div><div class="line">    <span class="comment"># source = "武沛齐"</span></div><div class="line">    source = <span class="string">"foo"</span></div><div class="line"> </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> source:</div><div class="line">        num = ord(i)</div><div class="line">        <span class="keyword">print</span> bin(num).replace(<span class="string">'b'</span>,<span class="string">''</span>)</div><div class="line"> </div><div class="line">    特别的，如果source是汉字 <span class="string">"武沛齐"</span>怎么办？</div><div class="line">    答：对于utf<span class="number">-8</span>，每一个汉字占 <span class="number">3</span> 个字节，那么 <span class="string">"武沛齐"</span> 则有 <span class="number">9</span>个字节</div><div class="line">       对于汉字，<span class="keyword">for</span>循环时候会按照 字节 迭代，那么在迭代时，将每一个字节转换 十进制数，然后再将十进制数转换成二进制</div><div class="line">        <span class="number">11100110</span> <span class="number">10101101</span> <span class="number">10100110</span> <span class="number">11100110</span> <span class="number">10110010</span> <span class="number">10011011</span> <span class="number">11101001</span> <span class="number">10111101</span> <span class="number">10010000</span></div><div class="line">        -------------------------- ----------------------------- -----------------------------</div><div class="line">                    武                         沛                           齐</div><div class="line"></div><div class="line"></div><div class="line">getbit(name, offset)</div><div class="line"><span class="comment"># 获取name对应的值的二进制表示中的某位的值 （0或1）</span></div><div class="line"></div><div class="line">bitcount(key, start=<span class="keyword">None</span>, end=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 获取name对应的值的二进制表示中 1 的个数</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># key，Redis的name</span></div><div class="line">    <span class="comment"># start，位起始位置</span></div><div class="line">    <span class="comment"># end，位结束位置</span></div><div class="line"></div><div class="line"></div><div class="line">bitop(operation, dest, *keys)</div><div class="line"><span class="comment"># 获取多个值，并将值做位运算，将最后的结果保存至新的name对应的值</span></div><div class="line"> </div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># operation,AND（并） 、 OR（或） 、 NOT（非） 、 XOR（异或）</span></div><div class="line">    <span class="comment"># dest, 新的Redis的name</span></div><div class="line">    <span class="comment"># *keys,要查找的Redis的name</span></div><div class="line"> </div><div class="line"><span class="comment"># 如：</span></div><div class="line">    bitop(<span class="string">"AND"</span>, <span class="string">'new_name'</span>, <span class="string">'n1'</span>, <span class="string">'n2'</span>, <span class="string">'n3'</span>)</div><div class="line">    <span class="comment"># 获取Redis中n1,n2,n3对应的值，然后讲所有的值做位运算（求并集），然后将结果保存 new_name 对应的值中</span></div><div class="line"></div><div class="line"></div><div class="line">strlen(name)</div><div class="line"><span class="comment"># 返回name对应值的字节长度（一个汉字3个字节）</span></div><div class="line"></div><div class="line">incr(self, name, amount=<span class="number">1</span>)</div><div class="line"><span class="comment"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name,Redis的name</span></div><div class="line">    <span class="comment"># amount,自增数（必须是整数）</span></div><div class="line"><span class="comment"># 注：同incrby</span></div><div class="line"></div><div class="line">incrbyfloat(self, name, amount=<span class="number">1.0</span>)</div><div class="line"><span class="comment"># 自增 name对应的值，当name不存在时，则创建name＝amount，否则，则自增。</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name,Redis的name</span></div><div class="line">    <span class="comment"># amount,自增数（浮点型）</span></div><div class="line"></div><div class="line">decr(self, name, amount=<span class="number">1</span>)</div><div class="line"><span class="comment"># 自减 name对应的值，当name不存在时，则创建name＝amount，否则，则自减。</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name,Redis的name</span></div><div class="line">    <span class="comment"># amount,自减数（整数）</span></div><div class="line"></div><div class="line">append(key, value)</div><div class="line"><span class="comment"># 在redis name对应的值后面追加内容</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    key, redis的name</div><div class="line">    value, 要追加的字符串</div></pre></td></tr></table></figure>
<h6 id="Hash操作"><a href="#Hash操作" class="headerlink" title="Hash操作"></a>Hash操作</h6><p>redis中Hash在内存中的存储格式如下图：</p>
<p><img src="https://i.loli.net/2017/07/15/596998070c641.png" width="400px"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">hset(name, key, value)</div><div class="line"></div><div class="line"><span class="comment"># name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># key，name对应的hash中的key</span></div><div class="line">    <span class="comment"># value，name对应的hash中的value</span></div><div class="line"><span class="comment"># 注：</span></div><div class="line">    <span class="comment"># hsetnx(name, key, value),当name对应的hash中不存在当前key时则创建（相当于添加）</span></div><div class="line"></div><div class="line">hmset(name, mapping)</div><div class="line"><span class="comment"># 在name对应的hash中批量设置键值对</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># mapping，字典，如：&#123;'k1':'v1', 'k2': 'v2'&#125;</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># r.hmset('xx', &#123;'k1':'v1', 'k2': 'v2'&#125;)</span></div><div class="line"></div><div class="line">hget(name,key)</div><div class="line"><span class="comment"># 在name对应的hash中获取根据key获取value</span></div><div class="line"></div><div class="line">hmget(name, keys, *args)</div><div class="line"><span class="comment"># 在name对应的hash中获取多个key的值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，reids对应的name</span></div><div class="line">    <span class="comment"># keys，要获取key集合，如：['k1', 'k2', 'k3']</span></div><div class="line">    <span class="comment"># *args，要获取的key，如：k1,k2,k3</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># r.mget('xx', ['k1', 'k2'])</span></div><div class="line">    <span class="comment"># 或</span></div><div class="line">    <span class="comment"># print r.hmget('xx', 'k1', 'k2')</span></div><div class="line"></div><div class="line">hgetall(name)</div><div class="line"><span class="comment">#获取name对应hash的所有键值</span></div><div class="line"></div><div class="line">hlen(name)</div><div class="line"><span class="comment"># 获取name对应的hash中键值对的个数</span></div><div class="line"></div><div class="line">hkeys(name)</div><div class="line"><span class="comment"># 获取name对应的hash中所有的key的值</span></div><div class="line"></div><div class="line">hvals(name)</div><div class="line"><span class="comment"># 获取name对应的hash中所有的value的值</span></div><div class="line"></div><div class="line">hexists(name, key)</div><div class="line"><span class="comment"># 检查name对应的hash是否存在当前传入的key</span></div><div class="line"></div><div class="line">hdel(name,*keys)</div><div class="line"><span class="comment"># 将name对应的hash中指定key的键值对删除</span></div><div class="line"></div><div class="line">hincrby(name, key, amount=<span class="number">1</span>)</div><div class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis中的name</span></div><div class="line">    <span class="comment"># key， hash对应的key</span></div><div class="line">    <span class="comment"># amount，自增数（整数）</span></div><div class="line"></div><div class="line">hincrbyfloat(name, key, amount=<span class="number">1.0</span>)</div><div class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis中的name</span></div><div class="line">    <span class="comment"># key， hash对应的key</span></div><div class="line">    <span class="comment"># amount，自增数（浮点数）</span></div><div class="line"><span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount</span></div><div class="line"></div><div class="line">hscan(name, cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 增量式迭代获取，对于数据大的数据非常有用，hscan可以实现分片的获取数据，并非一次性将数据全部获取完，从而放置内存被撑爆</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># cursor，游标（基于游标分批取获取数据）</span></div><div class="line">    <span class="comment"># match，匹配指定key，默认None 表示所有的key</span></div><div class="line">    <span class="comment"># count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># 第一次：cursor1, data1 = r.hscan('xx', cursor=0, match=None, count=None)</span></div><div class="line">    <span class="comment"># 第二次：cursor2, data1 = r.hscan('xx', cursor=cursor1, match=None, count=None)</span></div><div class="line">    <span class="comment"># ...</span></div><div class="line">    <span class="comment"># 直到返回值cursor的值为0时，表示数据已经通过分片获取完毕</span></div><div class="line"></div><div class="line">hscan_iter(name, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 利用yield封装hscan创建生成器，实现分批去redis中获取数据</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># match，匹配指定key，默认None 表示所有的key</span></div><div class="line">    <span class="comment"># count，每次分片最少获取个数，默认None表示采用Redis的默认分片个数</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># for item in r.hscan_iter('xx'):</span></div><div class="line">    <span class="comment">#     print item</span></div></pre></td></tr></table></figure>
<h6 id="List操作"><a href="#List操作" class="headerlink" title="List操作"></a>List操作</h6><p>redis中的List在在内存中按照一个name对应一个List来存储。如图：</p>
<p><img src="https://i.loli.net/2017/07/15/5969991be606a.jpg" width="400px"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line">lpush(name,values)</div><div class="line"><span class="comment"># 在name对应的list中添加元素，每个新的元素都添加到列表的最左边</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># r.lpush('oo', 11,22,33)</span></div><div class="line">    <span class="comment"># 保存顺序为: 33,22,11</span></div><div class="line"><span class="comment"># 扩展：</span></div><div class="line">    <span class="comment"># rpush(name, values) 表示从右向左操作</span></div><div class="line"></div><div class="line">lpushx(name,value)</div><div class="line"><span class="comment"># 在name对应的list中添加元素，只有name已经存在时，值添加到列表的最左边</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># rpushx(name, value) 表示从右向左操作</span></div><div class="line"></div><div class="line">llen(name)</div><div class="line"><span class="comment"># name对应的list元素的个数</span></div><div class="line"></div><div class="line">linsert(name, where, refvalue, value))</div><div class="line"><span class="comment"># 在name对应的列表的某一个值前或后插入一个新值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># where，BEFORE或AFTER</span></div><div class="line">    <span class="comment"># refvalue，标杆值，即：在它前后插入数据</span></div><div class="line">    <span class="comment"># value，要插入的数据</span></div><div class="line"></div><div class="line">r.lset(name, index, value)</div><div class="line"><span class="comment"># 对name对应的list中的某一个索引位置重新赋值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># index，list的索引位置</span></div><div class="line">    <span class="comment"># value，要设置的值</span></div><div class="line"></div><div class="line">r.lrem(name, value, num)</div><div class="line"><span class="comment"># 在name对应的list中删除指定的值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># value，要删除的值</span></div><div class="line">    <span class="comment"># num，  num=0，删除列表中所有的指定值；</span></div><div class="line">           <span class="comment"># num=2,从前到后，删除2个；</span></div><div class="line">           <span class="comment"># num=-2,从后向前，删除2个</span></div><div class="line"></div><div class="line">lpop(name)</div><div class="line"><span class="comment"># 在name对应的列表的左侧获取第一个元素并在列表中移除，返回值则是第一个元素</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># rpop(name) 表示从右向左操作</span></div><div class="line"></div><div class="line">lindex(name, index)</div><div class="line"><span class="comment">#在name对应的列表中根据索引获取列表元素</span></div><div class="line"></div><div class="line">lrange(name, start, end)</div><div class="line"><span class="comment"># 在name对应的列表分片获取数据</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># start，索引的起始位置</span></div><div class="line">    <span class="comment"># end，索引结束位置</span></div><div class="line"></div><div class="line">ltrim(name, start, end)</div><div class="line"><span class="comment"># 在name对应的列表中移除没有在start-end索引之间的值</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># start，索引的起始位置</span></div><div class="line">    <span class="comment"># end，索引结束位置</span></div><div class="line"></div><div class="line">rpoplpush(src, dst)</div><div class="line"><span class="comment"># 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># src，要取数据的列表的name</span></div><div class="line">    <span class="comment"># dst，要添加数据的列表的name</span></div><div class="line"></div><div class="line">blpop(keys, timeout)</div><div class="line"><span class="comment"># 将多个列表排列，按照从左到右去pop对应列表的元素</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># keys，redis的name的集合</span></div><div class="line">    <span class="comment"># timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># r.brpop(keys, timeout)，从右向左获取数据</span></div><div class="line"></div><div class="line">brpoplpush(src, dst, timeout=<span class="number">0</span>)</div><div class="line"><span class="comment"># 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># src，取出并要移除元素的列表对应的name</span></div><div class="line">    <span class="comment"># dst，要插入元素的列表对应的name</span></div><div class="line">    <span class="comment"># timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</span></div><div class="line"></div><div class="line">=============</div><div class="line">自定义增量迭代</div><div class="line"></div><div class="line"><span class="comment"># 由于redis类库中没有提供对列表元素的增量迭代，如果想要循环name对应的列表的所有元素，那么就需要：</span></div><div class="line">    <span class="comment"># 1、获取name对应的所有列表</span></div><div class="line">    <span class="comment"># 2、循环列表</span></div><div class="line"><span class="comment"># 但是，如果列表非常大，那么就有可能在第一步时就将程序的内容撑爆，所有有必要自定义一个增量迭代的功能：</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_iter</span><span class="params">(name)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    自定义redis列表增量迭代</div><div class="line">    :param name: redis中的name，即：迭代name对应的列表</div><div class="line">    :return: yield 返回 列表元素</div><div class="line">    """</div><div class="line">    list_count = r.llen(name)</div><div class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> xrange(list_count):</div><div class="line">        <span class="keyword">yield</span> r.lindex(name, index)</div><div class="line"> </div><div class="line"><span class="comment"># 使用</span></div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> list_iter(<span class="string">'pp'</span>):</div><div class="line">    <span class="keyword">print</span> item</div><div class="line">=============</div></pre></td></tr></table></figure>
<h6 id="Set操作"><a href="#Set操作" class="headerlink" title="Set操作"></a>Set操作</h6><p>Set集合就是不允许重复的列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">sadd(name,values)</div><div class="line"><span class="comment"># name对应的集合中添加元素</span></div><div class="line"></div><div class="line">scard(name)</div><div class="line"><span class="comment">#获取name对应的集合中元素个数</span></div><div class="line"></div><div class="line">sdiff(keys, *args)</div><div class="line"><span class="comment">#在第一个name对应的集合中且不在其他name对应的集合的元素集合</span></div><div class="line"></div><div class="line">sdiffstore(dest, keys, *args)</div><div class="line"><span class="comment"># 获取第一个name对应的集合中且不在其他name对应的集合，再将其新加入到dest对应的集合中</span></div><div class="line"></div><div class="line">sinter(keys, *args)</div><div class="line"><span class="comment"># 获取多一个name对应集合的并集</span></div><div class="line"></div><div class="line">sinterstore(dest, keys, *args)</div><div class="line"><span class="comment"># 获取多一个name对应集合的并集，再讲其加入到dest对应的集合中</span></div><div class="line"></div><div class="line">sismember(name, value)</div><div class="line"><span class="comment"># 检查value是否是name对应的集合的成员</span></div><div class="line"></div><div class="line">smembers(name)</div><div class="line"><span class="comment"># 获取name对应的集合的所有成员</span></div><div class="line"></div><div class="line">smove(src, dst, value)</div><div class="line"><span class="comment"># 将某个成员从一个集合中移动到另外一个集合</span></div><div class="line"></div><div class="line">spop(name)</div><div class="line"><span class="comment"># 从集合的右侧（尾部）移除一个成员，并将其返回</span></div><div class="line"></div><div class="line">srandmember(name, numbers)</div><div class="line"><span class="comment"># 从name对应的集合中随机获取 numbers 个元素</span></div><div class="line"></div><div class="line">srem(name, values)</div><div class="line"><span class="comment"># 在name对应的集合中删除某些值</span></div><div class="line"></div><div class="line">sunion(keys, *args)</div><div class="line"><span class="comment"># 获取多一个name对应的集合的并集</span></div><div class="line"></div><div class="line">sunionstore(dest,keys, *args)</div><div class="line"><span class="comment"># 获取多一个name对应的集合的并集，并将结果保存到dest对应的集合中</span></div><div class="line"></div><div class="line">sscan(name, cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line">sscan_iter(name, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</span></div></pre></td></tr></table></figure>
<h6 id="有序集合"><a href="#有序集合" class="headerlink" title="有序集合"></a>有序集合</h6><p>在集合的基础上，为每元素排序；元素的排序需要根据另外一个值来进行比较，所以，对于有序集合，每一个元素有两个值，即：值和分数，分数专门用来做排序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">zadd(name, *args, **kwargs)</div><div class="line"><span class="comment"># 在name对应的有序集合中添加元素</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">     <span class="comment"># zadd('zz', 'n1', 1, 'n2', 2)</span></div><div class="line">     <span class="comment"># 或</span></div><div class="line">     <span class="comment"># zadd('zz', n1=11, n2=22)</span></div><div class="line"></div><div class="line">zcard(name)</div><div class="line"><span class="comment"># 获取name对应的有序集合元素的数量</span></div><div class="line"></div><div class="line">zcount(name, min, max)</div><div class="line"><span class="comment"># 获取name对应的有序集合中分数 在 [min,max] 之间的个数</span></div><div class="line"></div><div class="line">zincrby(name, value, amount)</div><div class="line"><span class="comment"># 自增name对应的有序集合的 name 对应的分数</span></div><div class="line"></div><div class="line">r.zrange( name, start, end, desc=<span class="keyword">False</span>, withscores=<span class="keyword">False</span>, score_cast_func=float)</div><div class="line"><span class="comment"># 按照索引范围获取name对应的有序集合的元素</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># start，有序集合索引起始位置（非分数）</span></div><div class="line">    <span class="comment"># end，有序集合索引结束位置（非分数）</span></div><div class="line">    <span class="comment"># desc，排序规则，默认按照分数从小到大排序</span></div><div class="line">    <span class="comment"># withscores，是否获取元素的分数，默认只获取元素的值</span></div><div class="line">    <span class="comment"># score_cast_func，对分数进行数据转换的函数</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># 从大到小排序</span></div><div class="line">    <span class="comment"># zrevrange(name, start, end, withscores=False, score_cast_func=float)</span></div><div class="line"> </div><div class="line">    <span class="comment"># 按照分数范围获取name对应的有序集合的元素</span></div><div class="line">    <span class="comment"># zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)</span></div><div class="line">    <span class="comment"># 从大到小排序</span></div><div class="line">    <span class="comment"># zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</span></div><div class="line"></div><div class="line">zrank(name, value)</div><div class="line"><span class="comment"># 获取某个值在 name对应的有序集合中的排行（从 0 开始）</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># zrevrank(name, value)，从大到小排序</span></div><div class="line"></div><div class="line">zrangebylex(name, min, max, start=<span class="keyword">None</span>, num=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 当有序集合的所有成员都具有相同的分值时，有序集合的元素会根据成员的 值 （lexicographical ordering）来进行排序，而这个命令则可以返回给定的有序集合键 key 中， 元素的值介于 min 和 max 之间的成员</span></div><div class="line"><span class="comment"># 对集合中的每个成员进行逐个字节的对比（byte-by-byte compare）， 并按照从低到高的顺序， 返回排序后的集合成员。 如果两个字符串有一部分内容是相同的话， 那么命令会认为较长的字符串比较短的字符串要大</span></div><div class="line"><span class="comment"># 参数：</span></div><div class="line">    <span class="comment"># name，redis的name</span></div><div class="line">    <span class="comment"># min，左区间（值）。 + 表示正无限； - 表示负无限； ( 表示开区间； [ 则表示闭区间</span></div><div class="line">    <span class="comment"># min，右区间（值）</span></div><div class="line">    <span class="comment"># start，对结果进行分片处理，索引位置</span></div><div class="line">    <span class="comment"># num，对结果进行分片处理，索引后面的num个元素</span></div><div class="line"><span class="comment"># 如：</span></div><div class="line">    <span class="comment"># ZADD myzset 0 aa 0 ba 0 ca 0 da 0 ea 0 fa 0 ga</span></div><div class="line">    <span class="comment"># r.zrangebylex('myzset', "-", "[ca") 结果为：['aa', 'ba', 'ca']</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># 从大到小排序</span></div><div class="line">    <span class="comment"># zrevrangebylex(name, max, min, start=None, num=None)</span></div><div class="line"></div><div class="line">zrem(name, values)</div><div class="line"><span class="comment"># 删除name对应的有序集合中值是values的成员</span></div><div class="line"><span class="comment"># 如：zrem('zz', ['s1', 's2'])</span></div><div class="line"></div><div class="line">zremrangebyrank(name, min, max)</div><div class="line"><span class="comment"># 根据排行范围删除</span></div><div class="line"></div><div class="line">zremrangebyscore(name, min, max)</div><div class="line"><span class="comment"># 根据分数范围删除</span></div><div class="line"></div><div class="line">zremrangebylex(name, min, max)</div><div class="line"><span class="comment"># 根据值返回删除</span></div><div class="line"></div><div class="line">zscore(name, value)</div><div class="line"><span class="comment"># 获取name对应有序集合中 value 对应的分数</span></div><div class="line"></div><div class="line">zinterstore(dest, keys, aggregate=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 获取两个有序集合的交集，如果遇到相同值不同分数，则按照aggregate进行操作</span></div><div class="line"><span class="comment"># aggregate的值为:  SUM  MIN  MAX</span></div><div class="line"></div><div class="line">zunionstore(dest, keys, aggregate=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 获取两个有序集合的并集，如果遇到相同值不同分数，则按照aggregate进行操作</span></div><div class="line"><span class="comment"># aggregate的值为:  SUM  MIN  MAX</span></div><div class="line"></div><div class="line">zscan(name, cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>, score_cast_func=float)</div><div class="line">zscan_iter(name, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>,score_cast_func=float)</div><div class="line"><span class="comment"># 同字符串相似，相较于字符串新增score_cast_func，用来对分数进行操作</span></div></pre></td></tr></table></figure>
<h6 id="其他常用操作"><a href="#其他常用操作" class="headerlink" title="其他常用操作"></a>其他常用操作</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">delete(*names)</div><div class="line"><span class="comment"># 根据删除redis中的任意数据类型</span></div><div class="line"></div><div class="line">exists(name)</div><div class="line"><span class="comment"># 检测redis的name是否存在</span></div><div class="line"></div><div class="line">keys(pattern=<span class="string">'*'</span>)</div><div class="line"><span class="comment"># 根据模型获取redis的name</span></div><div class="line"><span class="comment"># 更多：</span></div><div class="line">    <span class="comment"># KEYS * 匹配数据库中所有 key 。</span></div><div class="line">    <span class="comment"># KEYS h?llo 匹配 hello ， hallo 和 hxllo 等。</span></div><div class="line">    <span class="comment"># KEYS h*llo 匹配 hllo 和 heeeeello 等。</span></div><div class="line">    <span class="comment"># KEYS h[ae]llo 匹配 hello 和 hallo ，但不匹配 hillo</span></div><div class="line"></div><div class="line">expire(name ,time)</div><div class="line"><span class="comment"># 为某个redis的某个name设置超时时间</span></div><div class="line"></div><div class="line">rename(src, dst)</div><div class="line"><span class="comment"># 对redis的name重命名为</span></div><div class="line"></div><div class="line">move(name, db))</div><div class="line"><span class="comment"># 将redis的某个值移动到指定的db下</span></div><div class="line"></div><div class="line">randomkey()</div><div class="line"><span class="comment"># 随机获取一个redis的name（不删除）</span></div><div class="line"></div><div class="line">type(name)</div><div class="line"><span class="comment"># 获取name对应值的类型</span></div><div class="line"></div><div class="line">scan(cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line">scan_iter(match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)</div><div class="line"><span class="comment"># 同字符串操作，用于增量迭代获取key</span></div></pre></td></tr></table></figure>
<h5 id="4、管道"><a href="#4、管道" class="headerlink" title="4、管道"></a>4、管道</h5><p>redis-py默认在执行每次请求都会创建（连接池申请连接）和断开（归还连接池）一次连接操作，如果想要在一次请求中指定多个命令，则可以使用pipline实现一次请求指定多个命令，并且默认情况下一次pipline 是原子性操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"> </div><div class="line">pool = redis.ConnectionPool(host=<span class="string">'10.211.55.4'</span>, port=<span class="number">6379</span>)</div><div class="line"> </div><div class="line">r = redis.Redis(connection_pool=pool)</div><div class="line"> </div><div class="line"><span class="comment"># pipe = r.pipeline(transaction=False)</span></div><div class="line">pipe = r.pipeline(transaction=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">pipe.set(<span class="string">'name'</span>, <span class="string">'alex'</span>)</div><div class="line">pipe.set(<span class="string">'role'</span>, <span class="string">'sb'</span>)</div><div class="line"> </div><div class="line">pipe.execute()</div></pre></td></tr></table></figure>
<h5 id="5、发布订阅"><a href="#5、发布订阅" class="headerlink" title="5、发布订阅"></a>5、发布订阅</h5><p><img src="https://i.loli.net/2017/07/15/59699c1eb5cbc.png" width="450px"></p>
<p>发布者：服务器</p>
<p>订阅者：Dashboad和数据处理</p>
<p>Demo如下：</p>
<p>RedisHelper</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> redis</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisHelper</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.__conn = redis.Redis(host=<span class="string">'10.211.55.4'</span>)</div><div class="line">        self.chan_sub = <span class="string">'fm104.5'</span></div><div class="line">        self.chan_pub = <span class="string">'fm104.5'</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">public</span><span class="params">(self, msg)</span>:</span></div><div class="line">        self.__conn.publish(self.chan_pub, msg)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">subscribe</span><span class="params">(self)</span>:</span></div><div class="line">        pub = self.__conn.pubsub()</div><div class="line">        pub.subscribe(self.chan_sub)</div><div class="line">        pub.parse_response()</div><div class="line">        <span class="keyword">return</span> pub</div></pre></td></tr></table></figure>
<p>订阅者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</div><div class="line"> </div><div class="line">obj = RedisHelper()</div><div class="line">redis_sub = obj.subscribe()</div><div class="line"> </div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    msg= redis_sub.parse_response()</div><div class="line">    <span class="keyword">print</span> msg</div></pre></td></tr></table></figure>
<p>发布者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">from</span> monitor.RedisHelper <span class="keyword">import</span> RedisHelper</div><div class="line"> </div><div class="line">obj = RedisHelper()</div><div class="line">obj.public(<span class="string">'hello'</span>)</div></pre></td></tr></table></figure>
<p>更多参见：<a href="https://github.com/andymccurdy/redis-py/" target="_blank" rel="external">https://github.com/andymccurdy/redis-py/</a></p>
<p><a href="http://doc.redisfans.com/" target="_blank" rel="external">http://doc.redisfans.com/</a></p>
<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>RabbitMQ是一个在AMQP基础上完整的，可复用的企业消息系统。他遵循Mozilla Public License开源协议。</p>
<p>MQ全称为Message Queue, 消息队列（MQ）是一种应用程序对应用程序的通信方法。应用程序通过读写出入队列的消息（针对应用程序的数据）来通信，而无需专用连接来链接它们。消 息传递指的是程序之间通过在消息中发送数据进行通信，而不是通过直接调用彼此来通信，直接调用通常是用于诸如远程过程调用的技术。排队指的是应用程序通过 队列来通信。队列的使用除去了接收和发送应用程序同时执行的要求。</p>
<h4 id="RabbitMQ安装"><a href="#RabbitMQ安装" class="headerlink" title="RabbitMQ安装"></a>RabbitMQ安装</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">安装配置epel源</div><div class="line">   $ rpm -ivh http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</div><div class="line"> </div><div class="line">安装erlang</div><div class="line">   $ yum -y install erlang</div><div class="line"> </div><div class="line">安装RabbitMQ</div><div class="line">   $ yum -y install rabbitmq-server</div></pre></td></tr></table></figure>
<p>注意：service rabbitmq-server start/stop</p>
<h4 id="安装API-1"><a href="#安装API-1" class="headerlink" title="安装API"></a>安装API</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">pip install pika</div><div class="line">or</div><div class="line">easy_install pika</div><div class="line">or</div><div class="line">源码</div><div class="line"> </div><div class="line">https://pypi.python.org/pypi/pika</div></pre></td></tr></table></figure>
<h4 id="使用API操作RabbitMQ"><a href="#使用API操作RabbitMQ" class="headerlink" title="使用API操作RabbitMQ"></a>使用API操作RabbitMQ</h4><h5 id="基于Queue实现生产者消费者模型"><a href="#基于Queue实现生产者消费者模型" class="headerlink" title="基于Queue实现生产者消费者模型"></a>基于Queue实现生产者消费者模型</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> Queue</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"></div><div class="line">message = Queue.Queue(<span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span><span class="params">(i)</span>:</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        message.put(i)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span><span class="params">(i)</span>:</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        msg = message.get()</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">12</span>):</div><div class="line">    t = threading.Thread(target=producer, args=(i,))</div><div class="line">    t.start()</div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">    t = threading.Thread(target=consumer, args=(i,))</div><div class="line">    t.start()</div></pre></td></tr></table></figure>
<p>对于RabbitMQ来说，生产和消费不再针对内存里的一个Queue对象，而是某台服务器上的RabbitMQ Server实现的消息队列。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="comment"># ######################### 生产者 #########################</span></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"> </div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</div><div class="line"> </div><div class="line">channel.basic_publish(exchange=<span class="string">''</span>,</div><div class="line">                      routing_key=<span class="string">'hello'</span>,</div><div class="line">                      body=<span class="string">'Hello World!'</span>)</div><div class="line">print(<span class="string">" [x] Sent 'Hello World!'"</span>)</div><div class="line">connection.close()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="comment"># ########################## 消费者 ##########################</span></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"> </div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] Received %r"</span> % body)</div><div class="line"> </div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=<span class="string">'hello'</span>,</div><div class="line">                      no_ack=<span class="keyword">True</span>)</div><div class="line"> </div><div class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<h5 id="1、acknowledgment-消息不丢失"><a href="#1、acknowledgment-消息不丢失" class="headerlink" title="1、acknowledgment 消息不丢失"></a>1、acknowledgment 消息不丢失</h5><p>no-ack ＝ False，如果消费者遇到情况(its channel is closed, connection is closed, or TCP connection is lost)挂掉了，那么，RabbitMQ会重新将该任务添加到队列中。</p>
<p>消费者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pika</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'10.211.55.4'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] Received %r"</span> % body)</div><div class="line">    <span class="keyword">import</span> time</div><div class="line">    time.sleep(<span class="number">10</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'ok'</span></div><div class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=<span class="string">'hello'</span>,</div><div class="line">                      no_ack=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<h5 id="2、durable-消息不丢失"><a href="#2、durable-消息不丢失" class="headerlink" title="2、durable   消息不丢失"></a>2、durable   消息不丢失</h5><p>生产者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'10.211.55.4'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line"><span class="comment"># make message persistent</span></div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>, durable=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">channel.basic_publish(exchange=<span class="string">''</span>,</div><div class="line">                      routing_key=<span class="string">'hello'</span>,</div><div class="line">                      body=<span class="string">'Hello World!'</span>,</div><div class="line">                      properties=pika.BasicProperties(</div><div class="line">                          delivery_mode=<span class="number">2</span>, <span class="comment"># make message persistent</span></div><div class="line">                      ))</div><div class="line">print(<span class="string">" [x] Sent 'Hello World!'"</span>)</div><div class="line">connection.close()</div></pre></td></tr></table></figure>
<p>消费者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'10.211.55.4'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line"><span class="comment"># make message persistent</span></div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>, durable=<span class="keyword">True</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] Received %r"</span> % body)</div><div class="line">    <span class="keyword">import</span> time</div><div class="line">    time.sleep(<span class="number">10</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'ok'</span></div><div class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=<span class="string">'hello'</span>,</div><div class="line">                      no_ack=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<h5 id="3、消息获取顺序"><a href="#3、消息获取顺序" class="headerlink" title="3、消息获取顺序"></a>3、消息获取顺序</h5><p>默认消息队列里的数据是按照顺序被消费者拿走，例如：消费者1 去队列中获取 奇数 序列的任务，消费者1去队列中获取 偶数 序列的任务。</p>
<p>channel.basic_qos(prefetch_count=1) 表示谁来谁取，不再按照奇偶数排列</p>
<p>消费者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(host=<span class="string">'10.211.55.4'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line"><span class="comment"># make message persistent</span></div><div class="line">channel.queue_declare(queue=<span class="string">'hello'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] Received %r"</span> % body)</div><div class="line">    <span class="keyword">import</span> time</div><div class="line">    time.sleep(<span class="number">10</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">'ok'</span></div><div class="line">    ch.basic_ack(delivery_tag = method.delivery_tag)</div><div class="line"></div><div class="line">channel.basic_qos(prefetch_count=<span class="number">1</span>)</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=<span class="string">'hello'</span>,</div><div class="line">                      no_ack=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for messages. To exit press CTRL+C'</span>)</div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<h5 id="4、发布订阅"><a href="#4、发布订阅" class="headerlink" title="4、发布订阅"></a>4、发布订阅</h5><p><img src="https://i.loli.net/2017/07/15/59699d9cba93d.png" width="500px"></p>
<p>发布订阅和简单的消息队列区别在于，发布订阅会将消息发送给所有的订阅者，而消息队列中的数据被消费一次便消失。所以，RabbitMQ实现发布和订阅时，会为每一个订阅者创建一个队列，而发布者发布消息时，会将消息放置在所有相关队列中。</p>
<p> exchange type = fanout</p>
<p>发布者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'logs'</span>,</div><div class="line">                         type=<span class="string">'fanout'</span>)</div><div class="line"></div><div class="line">message = <span class="string">' '</span>.join(sys.argv[<span class="number">1</span>:]) <span class="keyword">or</span> <span class="string">"info: Hello World!"</span></div><div class="line">channel.basic_publish(exchange=<span class="string">'logs'</span>,</div><div class="line">                      routing_key=<span class="string">''</span>,</div><div class="line">                      body=message)</div><div class="line">print(<span class="string">" [x] Sent %r"</span> % message)</div><div class="line">connection.close()</div></pre></td></tr></table></figure>
<p>订阅者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'logs'</span>,</div><div class="line">                         type=<span class="string">'fanout'</span>)</div><div class="line"></div><div class="line">result = channel.queue_declare(exclusive=<span class="keyword">True</span>)</div><div class="line">queue_name = result.method.queue</div><div class="line"></div><div class="line">channel.queue_bind(exchange=<span class="string">'logs'</span>,</div><div class="line">                   queue=queue_name)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] %r"</span> % body)</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=queue_name,</div><div class="line">                      no_ack=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<h5 id="5、关键字发送"><a href="#5、关键字发送" class="headerlink" title="5、关键字发送"></a>5、关键字发送</h5><p><img src="https://i.loli.net/2017/07/15/59699df4b893d.png" width="500px"></p>
<p> exchange type = direct</p>
<p>之前事例，发送消息时明确指定某个队列并向其中发送消息，RabbitMQ还支持根据关键字发送，即：队列绑定关键字，发送者将数据根据关键字发送到消息exchange，exchange根据 关键字 判定应该将数据发送至指定队列。</p>
<p>消费者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'direct_logs'</span>,</div><div class="line">                         type=<span class="string">'direct'</span>)</div><div class="line"></div><div class="line">result = channel.queue_declare(exclusive=<span class="keyword">True</span>)</div><div class="line">queue_name = result.method.queue</div><div class="line"></div><div class="line">severities = sys.argv[<span class="number">1</span>:]</div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> severities:</div><div class="line">    sys.stderr.write(<span class="string">"Usage: %s [info] [warning] [error]\n"</span> % sys.argv[<span class="number">0</span>])</div><div class="line">    sys.exit(<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> severity <span class="keyword">in</span> severities:</div><div class="line">    channel.queue_bind(exchange=<span class="string">'direct_logs'</span>,</div><div class="line">                       queue=queue_name,</div><div class="line">                       routing_key=severity)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=queue_name,</div><div class="line">                      no_ack=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<p>生产者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'direct_logs'</span>,</div><div class="line">                         type=<span class="string">'direct'</span>)</div><div class="line"></div><div class="line">severity = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">'info'</span></div><div class="line">message = <span class="string">' '</span>.join(sys.argv[<span class="number">2</span>:]) <span class="keyword">or</span> <span class="string">'Hello World!'</span></div><div class="line">channel.basic_publish(exchange=<span class="string">'direct_logs'</span>,</div><div class="line">                      routing_key=severity,</div><div class="line">                      body=message)</div><div class="line">print(<span class="string">" [x] Sent %r:%r"</span> % (severity, message))</div><div class="line">connection.close()</div></pre></td></tr></table></figure>
<h5 id="6、模糊匹配"><a href="#6、模糊匹配" class="headerlink" title="6、模糊匹配"></a>6、模糊匹配</h5><p><img src="https://i.loli.net/2017/07/15/59699e3d62436.png" width="500px"></p>
<p> exchange type = topic</p>
<p>在topic类型下，可以让队列绑定几个模糊的关键字，之后发送者将数据发送到exchange，exchange将传入”路由值“和 ”关键字“进行匹配，匹配成功，则将数据发送到指定队列。</p>
<ul>
<li># 表示可以匹配 0 个 或 多个 单词</li>
<li>*  表示只能匹配 一个 单词</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">发送者路由值              队列中</div><div class="line">old.boy.python          old.*  -- 不匹配</div><div class="line">old.boy.python          old.#  -- 匹配</div></pre></td></tr></table></figure>
<p>消费者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'topic_logs'</span>,</div><div class="line">                         type=<span class="string">'topic'</span>)</div><div class="line"></div><div class="line">result = channel.queue_declare(exclusive=<span class="keyword">True</span>)</div><div class="line">queue_name = result.method.queue</div><div class="line"></div><div class="line">binding_keys = sys.argv[<span class="number">1</span>:]</div><div class="line"><span class="keyword">if</span> <span class="keyword">not</span> binding_keys:</div><div class="line">    sys.stderr.write(<span class="string">"Usage: %s [binding_key]...\n"</span> % sys.argv[<span class="number">0</span>])</div><div class="line">    sys.exit(<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> binding_key <span class="keyword">in</span> binding_keys:</div><div class="line">    channel.queue_bind(exchange=<span class="string">'topic_logs'</span>,</div><div class="line">                       queue=queue_name,</div><div class="line">                       routing_key=binding_key)</div><div class="line"></div><div class="line">print(<span class="string">' [*] Waiting for logs. To exit press CTRL+C'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(ch, method, properties, body)</span>:</span></div><div class="line">    print(<span class="string">" [x] %r:%r"</span> % (method.routing_key, body))</div><div class="line"></div><div class="line">channel.basic_consume(callback,</div><div class="line">                      queue=queue_name,</div><div class="line">                      no_ack=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">channel.start_consuming()</div></pre></td></tr></table></figure>
<p>生产者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> pika</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(</div><div class="line">        host=<span class="string">'localhost'</span>))</div><div class="line">channel = connection.channel()</div><div class="line"></div><div class="line">channel.exchange_declare(exchange=<span class="string">'topic_logs'</span>,</div><div class="line">                         type=<span class="string">'topic'</span>)</div><div class="line"></div><div class="line">routing_key = sys.argv[<span class="number">1</span>] <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">'anonymous.info'</span></div><div class="line">message = <span class="string">' '</span>.join(sys.argv[<span class="number">2</span>:]) <span class="keyword">or</span> <span class="string">'Hello World!'</span></div><div class="line">channel.basic_publish(exchange=<span class="string">'topic_logs'</span>,</div><div class="line">                      routing_key=routing_key,</div><div class="line">                      body=message)</div><div class="line">print(<span class="string">" [x] Sent %r:%r"</span> % (routing_key, message))</div><div class="line">connection.close()</div></pre></td></tr></table></figure>
<p>注意：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">sudo rabbitmqctl add_user alex <span class="number">123</span></div><div class="line"><span class="comment"># 设置用户为administrator角色</span></div><div class="line">sudo rabbitmqctl set_user_tags alex administrator</div><div class="line"><span class="comment"># 设置权限</span></div><div class="line">sudo rabbitmqctl set_permissions -p <span class="string">"/"</span> alex <span class="string">'.'</span><span class="string">'.'</span><span class="string">'.'</span></div><div class="line"></div><div class="line"><span class="comment"># 然后重启rabbiMQ服务</span></div><div class="line">sudo /etc/init.d/rabbitmq-server restart</div><div class="line"> </div><div class="line"><span class="comment"># 然后可以使用刚才的用户远程连接rabbitmq server了。</span></div><div class="line">------------------------------</div><div class="line">credentials = pika.PlainCredentials(<span class="string">"alex"</span>,<span class="string">"123"</span>)</div><div class="line"></div><div class="line">connection = pika.BlockingConnection(pika.ConnectionParameters(<span class="string">'192.168.14.47'</span>,credentials=credentials))</div></pre></td></tr></table></figure>
<h3 id="SQLAlchemy"><a href="#SQLAlchemy" class="headerlink" title="SQLAlchemy"></a>SQLAlchemy</h3><p>SQLAlchemy是Python编程语言下的一款ORM框架，该框架建立在数据库API之上，使用关系对象映射进行数据库操作，简言之便是：将对象转换成SQL，然后使用数据API执行SQL并获取执行结果。</p>
<p><img src="https://i.loli.net/2017/07/15/59699f5e30338.png" width=""></p>
<p>Dialect用于和数据API进行交流，根据配置文件的不同调用不同的数据库API，从而实现对数据库的操作，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">MySQL-Python</div><div class="line">    mysql+mysqldb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</div><div class="line"> </div><div class="line">pymysql</div><div class="line">    mysql+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;/&lt;dbname&gt;[?&lt;options&gt;]</div><div class="line"> </div><div class="line">MySQL-Connector</div><div class="line">    mysql+mysqlconnector://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;</div><div class="line"> </div><div class="line">cx_Oracle</div><div class="line">    oracle+cx_oracle://user:pass@host:port/dbname[?key=value&amp;key=value...]</div><div class="line"> </div><div class="line">更多详见：http://docs.sqlalchemy.org/en/latest/dialects/index.html</div></pre></td></tr></table></figure>
<h4 id="步骤一："><a href="#步骤一：" class="headerlink" title="步骤一："></a>步骤一：</h4><p>使用 Engine/ConnectionPooling/Dialect 进行数据库操作，Engine使用ConnectionPooling连接数据库，然后再通过Dialect执行SQL语句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</div><div class="line"> </div><div class="line"> </div><div class="line">engine = create_engine(<span class="string">"mysql+mysqldb://root:123@127.0.0.1:3306/s11"</span>, max_overflow=<span class="number">5</span>)</div><div class="line"> </div><div class="line">engine.execute(</div><div class="line">    <span class="string">"INSERT INTO ts_test (a, b) VALUES ('2', 'v1')"</span></div><div class="line">)</div><div class="line"> </div><div class="line">engine.execute(</div><div class="line">     <span class="string">"INSERT INTO ts_test (a, b) VALUES (%s, %s)"</span>,</div><div class="line">    ((<span class="number">555</span>, <span class="string">"v1"</span>),(<span class="number">666</span>, <span class="string">"v1"</span>),)</div><div class="line">)</div><div class="line">engine.execute(</div><div class="line">    <span class="string">"INSERT INTO ts_test (a, b) VALUES (%(id)s, %(name)s)"</span>,</div><div class="line">    id=<span class="number">999</span>, name=<span class="string">"v1"</span></div><div class="line">)</div><div class="line"> </div><div class="line">result = engine.execute(<span class="string">'select * from ts_test'</span>)</div><div class="line">result.fetchall()</div></pre></td></tr></table></figure>
<p>事务操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</div><div class="line"></div><div class="line">engine = create_engine(<span class="string">"mysql+mysqldb://root:123@127.0.0.1:3306/s11"</span>, max_overflow=<span class="number">5</span>)</div><div class="line"></div><div class="line"><span class="comment"># 事务操作</span></div><div class="line"><span class="keyword">with</span> engine.begin() <span class="keyword">as</span> conn:</div><div class="line">    conn.execute(<span class="string">"insert into table (x, y, z) values (1, 2, 3)"</span>)</div><div class="line">    conn.execute(<span class="string">"my_special_procedure(5)"</span>)</div><div class="line">    </div><div class="line">conn = engine.connect()</div><div class="line"><span class="comment"># 事务操作 </span></div><div class="line"><span class="keyword">with</span> conn.begin():</div><div class="line">       conn.execute(<span class="string">"some statement"</span>, &#123;<span class="string">'x'</span>:<span class="number">5</span>, <span class="string">'y'</span>:<span class="number">10</span>&#125;)</div></pre></td></tr></table></figure>
<p><em>注：查看数据库连接：show status like ‘Threads%’;</em></p>
<h4 id="步骤二："><a href="#步骤二：" class="headerlink" title="步骤二："></a>步骤二：</h4><p>使用 Schema Type/SQL Expression Language/Engine/ConnectionPooling/Dialect 进行数据库操作。Engine使用Schema Type创建一个特定的结构对象，之后通过SQL Expression Language将该对象转换成SQL语句，然后通过 ConnectionPooling 连接数据库，再然后通过 Dialect 执行SQL，并获取结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine, Table, Column, Integer, String, MetaData, ForeignKey</div><div class="line"> </div><div class="line">metadata = MetaData()</div><div class="line"> </div><div class="line">user = Table(<span class="string">'user'</span>, metadata,</div><div class="line">    Column(<span class="string">'id'</span>, Integer, primary_key=<span class="keyword">True</span>),</div><div class="line">    Column(<span class="string">'name'</span>, String(<span class="number">20</span>)),</div><div class="line">)</div><div class="line"> </div><div class="line">color = Table(<span class="string">'color'</span>, metadata,</div><div class="line">    Column(<span class="string">'id'</span>, Integer, primary_key=<span class="keyword">True</span>),</div><div class="line">    Column(<span class="string">'name'</span>, String(<span class="number">20</span>)),</div><div class="line">)</div><div class="line">engine = create_engine(<span class="string">"mysql+mysqldb://root:123@127.0.0.1:3306/s11"</span>, max_overflow=<span class="number">5</span>)</div><div class="line"> </div><div class="line">metadata.create_all(engine)</div><div class="line"><span class="comment"># metadata.clear()</span></div><div class="line"><span class="comment"># metadata.remove()</span></div></pre></td></tr></table></figure>
<p>增删改查</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine, Table, Column, Integer, String, MetaData, ForeignKey</div><div class="line"></div><div class="line">metadata = MetaData()</div><div class="line"></div><div class="line">user = Table(<span class="string">'user'</span>, metadata,</div><div class="line">    Column(<span class="string">'id'</span>, Integer, primary_key=<span class="keyword">True</span>),</div><div class="line">    Column(<span class="string">'name'</span>, String(<span class="number">20</span>)),</div><div class="line">)</div><div class="line"></div><div class="line">color = Table(<span class="string">'color'</span>, metadata,</div><div class="line">    Column(<span class="string">'id'</span>, Integer, primary_key=<span class="keyword">True</span>),</div><div class="line">    Column(<span class="string">'name'</span>, String(<span class="number">20</span>)),</div><div class="line">)</div><div class="line">engine = create_engine(<span class="string">"mysql+mysqldb://root:123@127.0.0.1:3306/s11"</span>, max_overflow=<span class="number">5</span>)</div><div class="line"></div><div class="line">conn = engine.connect()</div><div class="line"></div><div class="line"><span class="comment"># 创建SQL语句，INSERT INTO "user" (id, name) VALUES (:id, :name)</span></div><div class="line">conn.execute(user.insert(),&#123;<span class="string">'id'</span>:<span class="number">7</span>,<span class="string">'name'</span>:<span class="string">'seven'</span>&#125;)</div><div class="line">conn.close()</div><div class="line"></div><div class="line"><span class="comment"># sql = user.insert().values(id=123, name='wu')</span></div><div class="line"><span class="comment"># conn.execute(sql)</span></div><div class="line"><span class="comment"># conn.close()</span></div><div class="line"></div><div class="line"><span class="comment"># sql = user.delete().where(user.c.id &gt; 1)</span></div><div class="line"></div><div class="line"><span class="comment"># sql = user.update().values(fullname=user.c.name)</span></div><div class="line"><span class="comment"># sql = user.update().where(user.c.name == 'jack').values(name='ed')</span></div><div class="line"></div><div class="line"><span class="comment"># sql = select([user, ])</span></div><div class="line"><span class="comment"># sql = select([user.c.id, ])</span></div><div class="line"><span class="comment"># sql = select([user.c.name, color.c.name]).where(user.c.id==color.c.id)</span></div><div class="line"><span class="comment"># sql = select([user.c.name]).order_by(user.c.name)</span></div><div class="line"><span class="comment"># sql = select([user]).group_by(user.c.name)</span></div><div class="line"></div><div class="line"><span class="comment"># result = conn.execute(sql)</span></div><div class="line"><span class="comment"># print result.fetchall()</span></div><div class="line"><span class="comment"># conn.close()</span></div></pre></td></tr></table></figure>
<p>更多内容详见：</p>
<p>​    <a href="http://www.jianshu.com/p/e6bba189fcbd" target="_blank" rel="external">http://www.jianshu.com/p/e6bba189fcbd</a></p>
<p>​    <a href="http://docs.sqlalchemy.org/en/latest/core/expression_api.html" target="_blank" rel="external">http://docs.sqlalchemy.org/en/latest/core/expression_api.html</a></p>
<p>注：SQLAlchemy无法修改表结构，如果需要可以使用SQLAlchemy开发者开源的另外一个软件Alembic来完成。</p>
<h4 id="步骤三："><a href="#步骤三：" class="headerlink" title="步骤三："></a>步骤三：</h4><p>使用 ORM/Schema Type/SQL Expression Language/Engine/ConnectionPooling/Dialect 所有组件对数据进行操作。根据类创建对象，对象转换成SQL，执行SQL。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String</div><div class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</div><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</div><div class="line"> </div><div class="line">engine = create_engine(<span class="string">"mysql+mysqldb://root:123@127.0.0.1:3306/s11"</span>, max_overflow=<span class="number">5</span>)</div><div class="line"> </div><div class="line">Base = declarative_base()</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></div><div class="line">    __tablename__ = <span class="string">'users'</span></div><div class="line">    id = Column(Integer, primary_key=<span class="keyword">True</span>)</div><div class="line">    name = Column(String(<span class="number">50</span>))</div><div class="line"> </div><div class="line"><span class="comment"># 寻找Base的所有子类，按照子类的结构在数据库中生成对应的数据表信息</span></div><div class="line"><span class="comment"># Base.metadata.create_all(engine)</span></div><div class="line"> </div><div class="line">Session = sessionmaker(bind=engine)</div><div class="line">session = Session()</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment"># ########## 增 ##########</span></div><div class="line"><span class="comment"># u = User(id=2, name='sb')</span></div><div class="line"><span class="comment"># session.add(u)</span></div><div class="line"><span class="comment"># session.add_all([</span></div><div class="line"><span class="comment">#     User(id=3, name='sb'),</span></div><div class="line"><span class="comment">#     User(id=4, name='sb')</span></div><div class="line"><span class="comment"># ])</span></div><div class="line"><span class="comment"># session.commit()</span></div><div class="line"> </div><div class="line"><span class="comment"># ########## 删除 ##########</span></div><div class="line"><span class="comment"># session.query(User).filter(User.id &gt; 2).delete()</span></div><div class="line"><span class="comment"># session.commit()</span></div><div class="line"> </div><div class="line"><span class="comment"># ########## 修改 ##########</span></div><div class="line"><span class="comment"># session.query(User).filter(User.id &gt; 2).update(&#123;'cluster_id' : 0&#125;)</span></div><div class="line"><span class="comment"># session.commit()</span></div><div class="line"><span class="comment"># ########## 查 ##########</span></div><div class="line"><span class="comment"># ret = session.query(User).filter_by(name='sb').first()</span></div><div class="line"> </div><div class="line"><span class="comment"># ret = session.query(User).filter_by(name='sb').all()</span></div><div class="line"><span class="comment"># print ret</span></div><div class="line"> </div><div class="line"><span class="comment"># ret = session.query(User).filter(User.name.in_(['sb','bb'])).all()</span></div><div class="line"><span class="comment"># print ret</span></div><div class="line"> </div><div class="line"><span class="comment"># ret = session.query(User.name.label('name_label')).all()</span></div><div class="line"><span class="comment"># print ret,type(ret)</span></div><div class="line"> </div><div class="line"><span class="comment"># ret = session.query(User).order_by(User.id).all()</span></div><div class="line"><span class="comment"># print ret</span></div><div class="line"> </div><div class="line"><span class="comment"># ret = session.query(User).order_by(User.id)[1:3]</span></div><div class="line"><span class="comment"># print ret</span></div><div class="line"><span class="comment"># session.commit()</span></div></pre></td></tr></table></figure>
<p>更多功能参见文档，<a href="http://files.cnblogs.com/files/wupeiqi/sqlalchemy.pdf.zip" target="_blank" rel="external">猛击这里</a>下载PDF</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://7u2o1q.com1.z0.glb.clouddn.com/webchat-reward.jpg" alt="Yaro WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://7u2o1q.com1.z0.glb.clouddn.com/alipay-reward.jpg" alt="Yaro Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/15/第10篇-Python操作MySQL/" rel="next" title="第10篇-Python操作MySQL">
                <i class="fa fa-chevron-left"></i> 第10篇-Python操作MySQL
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/15/第12篇-Django初级篇/" rel="prev" title="第12篇-Django初级篇">
                第12篇-Django初级篇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/"
           data-title="第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy" data-url="http://yoursite.com/2017/07/15/第11篇-Py-缓存 RabbitMQ、Redis、Memcache、SQLAlchemy/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7u2o1q.com1.z0.glb.clouddn.com/Yaro%E5%A4%B4%E5%83%8F1.png"
               alt="Yaro" />
          <p class="site-author-name" itemprop="name">Yaro</p>
          <p class="site-description motion-element" itemprop="description">生活=不断尝试,不断犯错</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">30</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yaro97" target="_blank" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wyzh97" target="_blank" title="Twitter">
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/mryaro" target="_blank" title="知乎">
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memcached"><span class="nav-number">1.</span> <span class="nav-text">Memcached</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Memcached安装和基本使用"><span class="nav-number">1.1.</span> <span class="nav-text">Memcached安装和基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Memcached安装："><span class="nav-number">1.1.1.</span> <span class="nav-text">Memcached安装：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#启动Memcached"><span class="nav-number">1.1.2.</span> <span class="nav-text">启动Memcached</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Memcached命令"><span class="nav-number">1.1.3.</span> <span class="nav-text">Memcached命令</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Python操作Memcached"><span class="nav-number">1.2.</span> <span class="nav-text">Python操作Memcached</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装API"><span class="nav-number">1.2.1.</span> <span class="nav-text">安装API</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1、第一次操作"><span class="nav-number">1.2.2.</span> <span class="nav-text">1、第一次操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、天生支持集群"><span class="nav-number">1.2.3.</span> <span class="nav-text">2、天生支持集群</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、add"><span class="nav-number">1.2.4.</span> <span class="nav-text">3、add</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、replace"><span class="nav-number">1.2.5.</span> <span class="nav-text">4、replace</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5、set-和-set-multi"><span class="nav-number">1.2.6.</span> <span class="nav-text">5、set 和 set_multi</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6、delete-和-delete-multi"><span class="nav-number">1.2.7.</span> <span class="nav-text">6、delete 和 delete_multi</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7、get-和-get-multi"><span class="nav-number">1.2.8.</span> <span class="nav-text">7、get 和 get_multi</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8、append-和-prepend"><span class="nav-number">1.2.9.</span> <span class="nav-text">8、append 和 prepend</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#9、decr-和-incr"><span class="nav-number">1.2.10.</span> <span class="nav-text">9、decr 和 incr　　</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10、gets-和-cas"><span class="nav-number">1.2.11.</span> <span class="nav-text">10、gets 和 cas</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis"><span class="nav-number">2.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、Redis安装和基本使用"><span class="nav-number">2.1.</span> <span class="nav-text">一、Redis安装和基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、Python操作Redis"><span class="nav-number">2.2.</span> <span class="nav-text">二、Python操作Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、操作模式"><span class="nav-number">2.2.1.</span> <span class="nav-text">1、操作模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、连接池"><span class="nav-number">2.2.2.</span> <span class="nav-text">2、连接池</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、操作"><span class="nav-number">2.2.3.</span> <span class="nav-text">3、操作</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#String操作"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">String操作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Hash操作"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">Hash操作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#List操作"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">List操作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Set操作"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">Set操作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#有序集合"><span class="nav-number">2.2.3.5.</span> <span class="nav-text">有序集合</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#其他常用操作"><span class="nav-number">2.2.3.6.</span> <span class="nav-text">其他常用操作</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、管道"><span class="nav-number">2.2.4.</span> <span class="nav-text">4、管道</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5、发布订阅"><span class="nav-number">2.2.5.</span> <span class="nav-text">5、发布订阅</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RabbitMQ"><span class="nav-number">3.</span> <span class="nav-text">RabbitMQ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RabbitMQ安装"><span class="nav-number">3.1.</span> <span class="nav-text">RabbitMQ安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#安装API-1"><span class="nav-number">3.2.</span> <span class="nav-text">安装API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用API操作RabbitMQ"><span class="nav-number">3.3.</span> <span class="nav-text">使用API操作RabbitMQ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基于Queue实现生产者消费者模型"><span class="nav-number">3.3.1.</span> <span class="nav-text">基于Queue实现生产者消费者模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1、acknowledgment-消息不丢失"><span class="nav-number">3.3.2.</span> <span class="nav-text">1、acknowledgment 消息不丢失</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、durable-消息不丢失"><span class="nav-number">3.3.3.</span> <span class="nav-text">2、durable   消息不丢失</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、消息获取顺序"><span class="nav-number">3.3.4.</span> <span class="nav-text">3、消息获取顺序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、发布订阅"><span class="nav-number">3.3.5.</span> <span class="nav-text">4、发布订阅</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5、关键字发送"><span class="nav-number">3.3.6.</span> <span class="nav-text">5、关键字发送</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6、模糊匹配"><span class="nav-number">3.3.7.</span> <span class="nav-text">6、模糊匹配</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQLAlchemy"><span class="nav-number">4.</span> <span class="nav-text">SQLAlchemy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤一："><span class="nav-number">4.1.</span> <span class="nav-text">步骤一：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤二："><span class="nav-number">4.2.</span> <span class="nav-text">步骤二：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#步骤三："><span class="nav-number">4.3.</span> <span class="nav-text">步骤三：</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yaro</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yaro97githubio"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
