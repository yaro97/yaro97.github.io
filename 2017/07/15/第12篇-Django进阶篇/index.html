<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="python," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Model到目前为止，当我们的程序涉及到数据库相关操作时，我们一般都会这么搞：

创建数据库，设计表结构和字段
使用 MySQLdb 来连接数据库，并编写数据访问层代码
业务逻辑层去调用数据访问层执行数据库操作

1234567891011121314151617import MySQLdb def GetList(sql):    db = MySQLdb.connect(user=&apos;root&apos;">
<meta property="og:type" content="article">
<meta property="og:title" content="第12篇-Django进阶篇">
<meta property="og:url" content="http://yoursite.com/2017/07/15/第12篇-Django进阶篇/index.html">
<meta property="og:site_name" content="Yaro's Notes">
<meta property="og:description" content="Model到目前为止，当我们的程序涉及到数据库相关操作时，我们一般都会这么搞：

创建数据库，设计表结构和字段
使用 MySQLdb 来连接数据库，并编写数据访问层代码
业务逻辑层去调用数据访问层执行数据库操作

1234567891011121314151617import MySQLdb def GetList(sql):    db = MySQLdb.connect(user=&apos;root&apos;">
<meta property="og:updated_time" content="2017-07-15T15:39:34.671Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第12篇-Django进阶篇">
<meta name="twitter:description" content="Model到目前为止，当我们的程序涉及到数据库相关操作时，我们一般都会这么搞：

创建数据库，设计表结构和字段
使用 MySQLdb 来连接数据库，并编写数据访问层代码
业务逻辑层去调用数据访问层执行数据库操作

1234567891011121314151617import MySQLdb def GetList(sql):    db = MySQLdb.connect(user=&apos;root&apos;">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/15/第12篇-Django进阶篇/"/>





  <title> 第12篇-Django进阶篇 | Yaro's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Yaro's Notes</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录/备忘/练手</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/15/第12篇-Django进阶篇/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Yaro">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://7u2o1q.com1.z0.glb.clouddn.com/Yaro%E5%A4%B4%E5%83%8F1.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Yaro's Notes">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Yaro's Notes" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                第12篇-Django进阶篇
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-15T15:40:47+08:00">
                2017-07-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/07/15/第12篇-Django进阶篇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/07/15/第12篇-Django进阶篇/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><p>到目前为止，当我们的程序涉及到数据库相关操作时，我们一般都会这么搞：</p>
<ul>
<li>创建数据库，设计表结构和字段</li>
<li>使用 MySQLdb 来连接数据库，并编写数据访问层代码</li>
<li>业务逻辑层去调用数据访问层执行数据库操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> MySQLdb</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetList</span><span class="params">(sql)</span>:</span></div><div class="line">    db = MySQLdb.connect(user=<span class="string">'root'</span>, db=<span class="string">'wupeiqidb'</span>, passwd=<span class="string">'1234'</span>, host=<span class="string">'localhost'</span>)</div><div class="line">    cursor = db.cursor()</div><div class="line">    cursor.execute(sql)</div><div class="line">    data = cursor.fetchall()</div><div class="line">    db.close()</div><div class="line">    <span class="keyword">return</span> data</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetSingle</span><span class="params">(sql)</span>:</span></div><div class="line">    db = MySQLdb.connect(user=<span class="string">'root'</span>, db=<span class="string">'wupeiqidb'</span>, passwd=<span class="string">'1234'</span>, host=<span class="string">'localhost'</span>)</div><div class="line">    cursor = db.cursor()</div><div class="line">    cursor.execute(sql)</div><div class="line">    data = cursor.fetchone()</div><div class="line">    db.close()</div><div class="line">    <span class="keyword">return</span> data</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>django为使用一种新的方式，即：关系对象映射（Object Relational Mapping，简称ORM）。</p>
<p>​    PHP：activerecord</p>
<p>​    Java：Hibernate </p>
<p>​    C#：Entity Framework</p>
<p>django中遵循 Code Frist 的原则，即：根据代码中定义的类来自动生成数据库表。</p>
<h4 id="一、创建表"><a href="#一、创建表" class="headerlink" title="一、创建表"></a>一、创建表</h4><h5 id="1、基本结构"><a href="#1、基本结构" class="headerlink" title="1、基本结构"></a>1、基本结构</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line">   </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">userinfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>)</div><div class="line">    email = models.EmailField()</div><div class="line">    memo = models.TextField()</div></pre></td></tr></table></figure>
<h6 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div></pre></td><td class="code"><pre><div class="line">AutoField(Field)</div><div class="line">    - int自增列，必须填入参数 primary_key=<span class="keyword">True</span></div><div class="line"></div><div class="line">BigAutoField(AutoField)</div><div class="line">    - bigint自增列，必须填入参数 primary_key=<span class="keyword">True</span></div><div class="line"></div><div class="line">    注：当model中如果没有自增列，则自动会创建一个列名为id的列</div><div class="line">    <span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">        <span class="comment"># 自动创建一个列名为id的且为自增的整数列</span></div><div class="line">        username = models.CharField(max_length=<span class="number">32</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></div><div class="line">        <span class="comment"># 自定义自增列</span></div><div class="line">        nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">        name = models.CharField(max_length=<span class="number">32</span>)</div><div class="line"></div><div class="line">SmallIntegerField(IntegerField):</div><div class="line">    - 小整数 <span class="number">-32768</span> ～ <span class="number">32767</span></div><div class="line"></div><div class="line">PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</div><div class="line">    - 正小整数 <span class="number">0</span> ～ <span class="number">32767</span></div><div class="line">IntegerField(Field)</div><div class="line">    - 整数列(有符号的) <span class="number">-2147483648</span> ～ <span class="number">2147483647</span></div><div class="line"></div><div class="line">PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</div><div class="line">    - 正整数 <span class="number">0</span> ～ <span class="number">2147483647</span></div><div class="line"></div><div class="line">BigIntegerField(IntegerField):</div><div class="line">    - 长整型(有符号的) <span class="number">-9223372036854775808</span> ～ <span class="number">9223372036854775807</span></div><div class="line"></div><div class="line">自定义无符号整数字段</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UnsignedIntegerField</span><span class="params">(models.IntegerField)</span>:</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">db_type</span><span class="params">(self, connection)</span>:</span></div><div class="line">            <span class="keyword">return</span> <span class="string">'integer UNSIGNED'</span></div><div class="line"></div><div class="line">    PS: 返回值为字段在数据库中的属性，Django字段默认的值为：</div><div class="line">        <span class="string">'AutoField'</span>: <span class="string">'integer AUTO_INCREMENT'</span>,</div><div class="line">        <span class="string">'BigAutoField'</span>: <span class="string">'bigint AUTO_INCREMENT'</span>,</div><div class="line">        <span class="string">'BinaryField'</span>: <span class="string">'longblob'</span>,</div><div class="line">        <span class="string">'BooleanField'</span>: <span class="string">'bool'</span>,</div><div class="line">        <span class="string">'CharField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</div><div class="line">        <span class="string">'CommaSeparatedIntegerField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</div><div class="line">        <span class="string">'DateField'</span>: <span class="string">'date'</span>,</div><div class="line">        <span class="string">'DateTimeField'</span>: <span class="string">'datetime'</span>,</div><div class="line">        <span class="string">'DecimalField'</span>: <span class="string">'numeric(%(max_digits)s, %(decimal_places)s)'</span>,</div><div class="line">        <span class="string">'DurationField'</span>: <span class="string">'bigint'</span>,</div><div class="line">        <span class="string">'FileField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</div><div class="line">        <span class="string">'FilePathField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</div><div class="line">        <span class="string">'FloatField'</span>: <span class="string">'double precision'</span>,</div><div class="line">        <span class="string">'IntegerField'</span>: <span class="string">'integer'</span>,</div><div class="line">        <span class="string">'BigIntegerField'</span>: <span class="string">'bigint'</span>,</div><div class="line">        <span class="string">'IPAddressField'</span>: <span class="string">'char(15)'</span>,</div><div class="line">        <span class="string">'GenericIPAddressField'</span>: <span class="string">'char(39)'</span>,</div><div class="line">        <span class="string">'NullBooleanField'</span>: <span class="string">'bool'</span>,</div><div class="line">        <span class="string">'OneToOneField'</span>: <span class="string">'integer'</span>,</div><div class="line">        <span class="string">'PositiveIntegerField'</span>: <span class="string">'integer UNSIGNED'</span>,</div><div class="line">        <span class="string">'PositiveSmallIntegerField'</span>: <span class="string">'smallint UNSIGNED'</span>,</div><div class="line">        <span class="string">'SlugField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</div><div class="line">        <span class="string">'SmallIntegerField'</span>: <span class="string">'smallint'</span>,</div><div class="line">        <span class="string">'TextField'</span>: <span class="string">'longtext'</span>,</div><div class="line">        <span class="string">'TimeField'</span>: <span class="string">'time'</span>,</div><div class="line">        <span class="string">'UUIDField'</span>: <span class="string">'char(32)'</span>,</div><div class="line"></div><div class="line">BooleanField(Field)</div><div class="line">    - 布尔值类型</div><div class="line"></div><div class="line">NullBooleanField(Field):</div><div class="line">    - 可以为空的布尔值</div><div class="line"></div><div class="line">CharField(Field)</div><div class="line">    - 字符类型</div><div class="line">    - 必须提供max_length参数， max_length表示字符长度</div><div class="line"></div><div class="line">TextField(Field)</div><div class="line">    - 文本类型</div><div class="line"></div><div class="line">EmailField(CharField)：</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证机制</div><div class="line"></div><div class="line">IPAddressField(Field)</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</div><div class="line"></div><div class="line">GenericIPAddressField(Field)</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</div><div class="line">    - 参数：</div><div class="line">        protocol，用于指定Ipv4或Ipv6， <span class="string">'both'</span>,<span class="string">"ipv4"</span>,<span class="string">"ipv6"</span></div><div class="line">        unpack_ipv4， 如果指定为<span class="keyword">True</span>，则输入::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>，开启刺功能，需要protocol=<span class="string">"both"</span></div><div class="line"></div><div class="line">URLField(CharField)</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证 URL</div><div class="line"></div><div class="line">SlugField(CharField)</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</div><div class="line"></div><div class="line">CommaSeparatedIntegerField(CharField)</div><div class="line">    - 字符串类型，格式必须为逗号分割的数字</div><div class="line"></div><div class="line">UUIDField(Field)</div><div class="line">    - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</div><div class="line"></div><div class="line">FilePathField(Field)</div><div class="line">    - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</div><div class="line">    - 参数：</div><div class="line">            path,                      文件夹路径</div><div class="line">            match=<span class="keyword">None</span>,                正则匹配</div><div class="line">            recursive=<span class="keyword">False</span>,           递归下面的文件夹</div><div class="line">            allow_files=<span class="keyword">True</span>,          允许文件</div><div class="line">            allow_folders=<span class="keyword">False</span>,       允许文件夹</div><div class="line"></div><div class="line">FileField(Field)</div><div class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</div><div class="line">    - 参数：</div><div class="line">        upload_to = <span class="string">""</span>      上传文件的保存路径</div><div class="line">        storage = <span class="keyword">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</div><div class="line"></div><div class="line">ImageField(FileField)</div><div class="line">    - 字符串，路径保存在数据库，文件上传到指定目录</div><div class="line">    - 参数：</div><div class="line">        upload_to = <span class="string">""</span>      上传文件的保存路径</div><div class="line">        storage = <span class="keyword">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</div><div class="line">        width_field=<span class="keyword">None</span>,   上传图片的高度保存的数据库字段名（字符串）</div><div class="line">        height_field=<span class="keyword">None</span>   上传图片的宽度保存的数据库字段名（字符串）</div><div class="line"></div><div class="line">DateTimeField(DateField)</div><div class="line">    - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</div><div class="line"></div><div class="line">DateField(DateTimeCheckMixin, Field)</div><div class="line">    - 日期格式      YYYY-MM-DD</div><div class="line"></div><div class="line">TimeField(DateTimeCheckMixin, Field)</div><div class="line">    - 时间格式      HH:MM[:ss[.uuuuuu]]</div><div class="line"></div><div class="line">DurationField(Field)</div><div class="line">    - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</div><div class="line"></div><div class="line">FloatField(Field)</div><div class="line">    - 浮点型</div><div class="line"></div><div class="line">DecimalField(Field)</div><div class="line">    - <span class="number">10</span>进制小数</div><div class="line">    - 参数：</div><div class="line">        max_digits，小数总长度</div><div class="line">        decimal_places，小数位长度</div><div class="line"></div><div class="line">BinaryField(Field)</div><div class="line">    - 二进制类型</div></pre></td></tr></table></figure>
<h6 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">null                数据库中字段是否可以为空</div><div class="line">db_column           数据库中字段的列名</div><div class="line">db_tablespace</div><div class="line">default             数据库中字段的默认值</div><div class="line">primary_key         数据库中字段是否为主键</div><div class="line">db_index            数据库中字段是否可以建立索引</div><div class="line">unique              数据库中字段是否可以建立唯一索引</div><div class="line">unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引</div><div class="line">unique_for_month    数据库中字段【月】部分是否可以建立唯一索引</div><div class="line">unique_for_year     数据库中字段【年】部分是否可以建立唯一索引</div><div class="line"></div><div class="line">verbose_name        Admin中显示的字段名称</div><div class="line">blank               Admin中是否允许用户输入为空</div><div class="line">editable            Admin中是否可以编辑</div><div class="line">help_text           Admin中该字段的提示信息</div><div class="line">choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作</div><div class="line">                    如：gf = models.IntegerField(choices=[(<span class="number">0</span>, <span class="string">'何穗'</span>),(<span class="number">1</span>, <span class="string">'大表姐'</span>),],default=<span class="number">1</span>)</div><div class="line"></div><div class="line">error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；</div><div class="line">                    字典健：null, blank, invalid, invalid_choice, unique, <span class="keyword">and</span> unique_for_date</div><div class="line">                    如：&#123;<span class="string">'null'</span>: <span class="string">"不能为空."</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>&#125;</div><div class="line"></div><div class="line">validators          自定义错误验证（列表类型），从而定制想要的验证规则</div><div class="line">                    <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</div><div class="line">                    <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> EmailValidator,URLValidator,DecimalValidator,\</div><div class="line">                    MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator</div><div class="line">                    如：</div><div class="line">                        test = models.CharField(</div><div class="line">                            max_length=<span class="number">32</span>,</div><div class="line">                            error_messages=&#123;</div><div class="line">                                <span class="string">'c1'</span>: <span class="string">'优先错信息1'</span>,</div><div class="line">                                <span class="string">'c2'</span>: <span class="string">'优先错信息2'</span>,</div><div class="line">                                <span class="string">'c3'</span>: <span class="string">'优先错信息3'</span>,</div><div class="line">                            &#125;,</div><div class="line">                            validators=[</div><div class="line">                                RegexValidator(regex=<span class="string">'root_\d+'</span>, message=<span class="string">'错误了'</span>, code=<span class="string">'c1'</span>),</div><div class="line">                                RegexValidator(regex=<span class="string">'root_112233\d+'</span>, message=<span class="string">'又错误了'</span>, code=<span class="string">'c2'</span>),</div><div class="line">                                EmailValidator(message=<span class="string">'又错误了'</span>, code=<span class="string">'c3'</span>), ]</div><div class="line">                        )</div></pre></td></tr></table></figure>
<h6 id="元信息"><a href="#元信息" class="headerlink" title="元信息"></a>元信息</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">    username = models.CharField(max_length=<span class="number">32</span>)</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        <span class="comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></div><div class="line">        db_table = <span class="string">"table_name"</span></div><div class="line"></div><div class="line">        <span class="comment"># 联合索引</span></div><div class="line">        index_together = [</div><div class="line">            (<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>),</div><div class="line">        ]</div><div class="line"></div><div class="line">        <span class="comment"># 联合唯一索引</span></div><div class="line">        unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</div><div class="line"></div><div class="line">        <span class="comment"># admin中显示的表名称</span></div><div class="line">        verbose_name</div><div class="line"></div><div class="line">        <span class="comment"># verbose_name加s</span></div><div class="line">        verbose_name_plural</div><div class="line">    </div><div class="line">更多：https://docs.djangoproject.com/en/<span class="number">1.10</span>/ref/models/options/</div></pre></td></tr></table></figure>
<h6 id="拓展知识"><a href="#拓展知识" class="headerlink" title="拓展知识"></a>拓展知识</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span>触发Model中的验证和错误提示有两种方式：</div><div class="line">    a. Django Admin中的错误信息会优先根据Admiin内部的ModelForm错误信息提示，如果都成功，才来检查Model的字段并显示指定错误信息</div><div class="line">    b. 调用Model对象的 clean_fields 方法，如：</div><div class="line">        <span class="comment"># models.py</span></div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">            nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">            username = models.CharField(max_length=<span class="number">32</span>)</div><div class="line"></div><div class="line">            email = models.EmailField(error_messages=&#123;<span class="string">'invalid'</span>: <span class="string">'格式错了.'</span>&#125;)</div><div class="line"></div><div class="line">        <span class="comment"># views.py</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">            obj = models.UserInfo(username=<span class="string">'11234'</span>, email=<span class="string">'uu'</span>)</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                print(obj.clean_fields())</div><div class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                print(e)</div><div class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</div><div class="line"></div><div class="line">       <span class="comment"># Model的clean方法是一个钩子，可用于定制操作，如：上述的异常处理。</span></div><div class="line"></div><div class="line"><span class="number">2.</span>Admin中修改错误提示</div><div class="line">    <span class="comment"># admin.py</span></div><div class="line">    <span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</div><div class="line">    <span class="keyword">from</span> model_club <span class="keyword">import</span> models</div><div class="line">    <span class="keyword">from</span> django <span class="keyword">import</span> forms</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UserInfoForm</span><span class="params">(forms.ModelForm)</span>:</span></div><div class="line">        username = forms.CharField(error_messages=&#123;<span class="string">'required'</span>: <span class="string">'用户名不能为空.'</span>&#125;)</div><div class="line">        email = forms.EmailField(error_messages=&#123;<span class="string">'invalid'</span>: <span class="string">'邮箱格式错误.'</span>&#125;)</div><div class="line">        age = forms.IntegerField(initial=<span class="number">1</span>, error_messages=&#123;<span class="string">'required'</span>: <span class="string">'请输入数值.'</span>, <span class="string">'invalid'</span>: <span class="string">'年龄必须为数值.'</span>&#125;)</div><div class="line"></div><div class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">            model = models.UserInfo</div><div class="line">            <span class="comment"># fields = ('username',)</span></div><div class="line">            fields = <span class="string">"__all__"</span></div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></div><div class="line">        form = UserInfoForm</div><div class="line"></div><div class="line">    admin.site.register(models.UserInfo, UserInfoAdmin)</div></pre></td></tr></table></figure>
<h5 id="2、连表结构"><a href="#2、连表结构" class="headerlink" title="2、连表结构"></a>2、连表结构</h5><ul>
<li>一对多：models.ForeignKey(其他表)</li>
<li>多对多：models.ManyToManyField(其他表)</li>
<li>一对一：models.OneToOneField(其他表)</li>
</ul>
<blockquote>
<p>应用场景：</p>
<ul>
<li>一对多：当一张表中创建一行数据时，有一个单选的下拉框（可以被重复选择）<br><em>例如：创建用户信息时候，需要选择一个用户类型【普通用户】【金牌用户】【铂金用户】等。</em></li>
<li>多对多：在某表中创建一行数据是，有一个可以多选的下拉框<br><em>例如：创建用户信息，需要为用户指定多个爱好</em></li>
<li>一对一：在某表中创建一行数据时，有一个单选的下拉框（下拉框中的内容被用过一次就消失了<br><em>例如：原有含10列数据的一张表保存相关信息，经过一段时间之后，10列无法满足需求，需要为原来的表再添加5列数据</em></li>
</ul>
</blockquote>
<h6 id="字段以及参数"><a href="#字段以及参数" class="headerlink" title="字段以及参数"></a>字段以及参数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line">ForeignKey(ForeignObject) <span class="comment"># ForeignObject(RelatedField)</span></div><div class="line">    to,                         <span class="comment"># 要进行关联的表名</span></div><div class="line">    to_field=<span class="keyword">None</span>,              <span class="comment"># 要关联的表中的字段名称</span></div><div class="line">    on_delete=<span class="keyword">None</span>,             <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></div><div class="line">                                    - models.CASCADE，删除关联数据，与之关联也删除</div><div class="line">                                    - models.DO_NOTHING，删除关联数据，引发错误IntegrityError</div><div class="line">                                    - models.PROTECT，删除关联数据，引发错误ProtectedError</div><div class="line">                                    - models.SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</div><div class="line">                                    - models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</div><div class="line">                                    - models.SET，删除关联数据，</div><div class="line">                                                  a. 与之关联的值设置为指定值，设置：models.SET(值)</div><div class="line">                                                  b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</div><div class="line"></div><div class="line">                                                    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></div><div class="line">                                                        <span class="keyword">return</span> <span class="number">10</span></div><div class="line"></div><div class="line">                                                    <span class="class"><span class="keyword">class</span> <span class="title">MyModel</span><span class="params">(models.Model)</span>:</span></div><div class="line">                                                        user = models.ForeignKey(</div><div class="line">                                                            to=<span class="string">"User"</span>,</div><div class="line">                                                            to_field=<span class="string">"id"</span></div><div class="line">                                                            on_delete=models.SET(func),)</div><div class="line">    related_name=<span class="keyword">None</span>,          <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></div><div class="line">    related_query_name=<span class="keyword">None</span>,    <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span></div><div class="line">    limit_choices_to=<span class="keyword">None</span>,      <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></div><div class="line">                                <span class="comment"># 如：</span></div><div class="line">                                        - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</div><div class="line">                                        - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</div><div class="line"></div><div class="line">                                        <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</div><div class="line">                                        - limit_choices_to=Q(nid__gt=<span class="number">10</span>)</div><div class="line">                                        - limit_choices_to=Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)</div><div class="line">                                        - limit_choices_to=<span class="keyword">lambda</span> : Q(Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)) &amp; Q(caption=<span class="string">'root'</span>)</div><div class="line">    db_constraint=<span class="keyword">True</span>          <span class="comment"># 是否在数据库中创建外键约束</span></div><div class="line">    parent_link=<span class="keyword">False</span>           <span class="comment"># 在Admin中是否显示关联数据</span></div><div class="line"></div><div class="line"></div><div class="line">OneToOneField(ForeignKey)</div><div class="line">    to,                         <span class="comment"># 要进行关联的表名</span></div><div class="line">    to_field=<span class="keyword">None</span>               <span class="comment"># 要关联的表中的字段名称</span></div><div class="line">    on_delete=<span class="keyword">None</span>,             <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></div><div class="line"></div><div class="line">                                <span class="comment">###### 对于一对一 ######</span></div><div class="line">                                <span class="comment"># 1. 一对一其实就是 一对多 + 唯一索引</span></div><div class="line">                                <span class="comment"># 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span></div><div class="line">                                <span class="comment"># 如下会在A表中额外增加一个c_ptr_id列且唯一：</span></div><div class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(models.Model)</span>:</span></div><div class="line">                                            nid = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">                                            part = models.CharField(max_length=<span class="number">12</span>)</div><div class="line"></div><div class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(C)</span>:</span></div><div class="line">                                            id = models.AutoField(primary_key=<span class="keyword">True</span>)</div><div class="line">                                            code = models.CharField(max_length=<span class="number">1</span>)</div><div class="line"></div><div class="line">ManyToManyField(RelatedField)</div><div class="line">    to,                         <span class="comment"># 要进行关联的表名</span></div><div class="line">    related_name=<span class="keyword">None</span>,          <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></div><div class="line">    related_query_name=<span class="keyword">None</span>,    <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span></div><div class="line">    limit_choices_to=<span class="keyword">None</span>,      <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></div><div class="line">                                <span class="comment"># 如：</span></div><div class="line">                                        - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</div><div class="line">                                        - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</div><div class="line"></div><div class="line">                                        <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</div><div class="line">                                        - limit_choices_to=Q(nid__gt=<span class="number">10</span>)</div><div class="line">                                        - limit_choices_to=Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)</div><div class="line">                                        - limit_choices_to=<span class="keyword">lambda</span> : Q(Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)) &amp; Q(caption=<span class="string">'root'</span>)</div><div class="line">    symmetrical=<span class="keyword">None</span>,           <span class="comment"># 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span></div><div class="line">                                <span class="comment"># 做如下操作时，不同的symmetrical会有不同的可选字段</span></div><div class="line">                                    models.BB.objects.filter(...)</div><div class="line"></div><div class="line">                                    <span class="comment"># 可选字段有：code, id, m1</span></div><div class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">BB</span><span class="params">(models.Model)</span>:</span></div><div class="line"></div><div class="line">                                        code = models.CharField(max_length=<span class="number">12</span>)</div><div class="line">                                        m1 = models.ManyToManyField(<span class="string">'self'</span>,symmetrical=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">                                    <span class="comment"># 可选字段有: bb, code, id, m1</span></div><div class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">BB</span><span class="params">(models.Model)</span>:</span></div><div class="line"></div><div class="line">                                        code = models.CharField(max_length=<span class="number">12</span>)</div><div class="line">                                        m1 = models.ManyToManyField(<span class="string">'self'</span>,symmetrical=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">    through=<span class="keyword">None</span>,               <span class="comment"># 自定义第三张表时，使用字段用于指定关系表</span></div><div class="line">    through_fields=<span class="keyword">None</span>,        <span class="comment"># 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span></div><div class="line">                                    <span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line">                                    <span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></div><div class="line">                                        name = models.CharField(max_length=<span class="number">50</span>)</div><div class="line"></div><div class="line">                                    <span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></div><div class="line">                                        name = models.CharField(max_length=<span class="number">128</span>)</div><div class="line">                                        members = models.ManyToManyField(</div><div class="line">                                            Person,</div><div class="line">                                            through=<span class="string">'Membership'</span>,</div><div class="line">                                            through_fields=(<span class="string">'group'</span>, <span class="string">'person'</span>),</div><div class="line">                                        )</div><div class="line"></div><div class="line">                                    <span class="class"><span class="keyword">class</span> <span class="title">Membership</span><span class="params">(models.Model)</span>:</span></div><div class="line">                                        group = models.ForeignKey(Group, on_delete=models.CASCADE)</div><div class="line">                                        person = models.ForeignKey(Person, on_delete=models.CASCADE)</div><div class="line">                                        inviter = models.ForeignKey(</div><div class="line">                                            Person,</div><div class="line">                                            on_delete=models.CASCADE,</div><div class="line">                                            related_name=<span class="string">"membership_invites"</span>,</div><div class="line">                                        )</div><div class="line">                                        invite_reason = models.CharField(max_length=<span class="number">64</span>)</div><div class="line">    db_constraint=<span class="keyword">True</span>,         <span class="comment"># 是否在数据库中创建外键约束</span></div><div class="line">    db_table=<span class="keyword">None</span>,              <span class="comment"># 默认创建第三张表时，数据库中表的名称</span></div></pre></td></tr></table></figure>
<h4 id="二、操作表"><a href="#二、操作表" class="headerlink" title="二、操作表"></a>二、操作表</h4><h5 id="1、基本操作"><a href="#1、基本操作" class="headerlink" title="1、基本操作"></a>1、基本操作</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 增</span></div><div class="line"><span class="comment"># models.Tb1.objects.create(c1='xx', c2='oo')  增加一条数据，可以接受字典类型数据 **kwargs</span></div><div class="line"></div><div class="line"><span class="comment"># obj = models.Tb1(c1='xx', c2='oo')</span></div><div class="line"><span class="comment"># obj.save()</span></div><div class="line"></div><div class="line"><span class="comment"># 查</span></div><div class="line"><span class="comment"># models.Tb1.objects.get(id=123)         # 获取单条数据，不存在则报错（不建议）</span></div><div class="line"><span class="comment"># models.Tb1.objects.all()               # 获取全部</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven') # 获取指定条件的数据</span></div><div class="line"></div><div class="line"><span class="comment"># 删</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').delete() # 删除指定条件的数据</span></div><div class="line"></div><div class="line"><span class="comment"># 改</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').update(gender='0')  # 将指定条件的数据更新，均支持 **kwargs</span></div><div class="line"><span class="comment"># obj = models.Tb1.objects.get(id=1)</span></div><div class="line"><span class="comment"># obj.c1 = '111'</span></div><div class="line"><span class="comment"># obj.save()                                                 # 修改单条数据</span></div></pre></td></tr></table></figure>
<h5 id="2、进阶操作（了不起的双下划线）"><a href="#2、进阶操作（了不起的双下划线）" class="headerlink" title="2、进阶操作（了不起的双下划线）"></a>2、进阶操作（了不起的双下划线）</h5><p>利用双下划线将字段和对应的操作连接起来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 获取个数</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').count()</span></div><div class="line"></div><div class="line"><span class="comment"># 大于，小于</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__gt=1)              # 获取id大于1的值</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__gte=1)              # 获取id大于等于1的值</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__lt=10)             # 获取id小于10的值</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__lte=10)             # 获取id小于10的值</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__lt=10, id__gt=1)   # 获取id大于1 且 小于10的值</span></div><div class="line"></div><div class="line"><span class="comment"># in</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__in=[11, 22, 33])   # 获取id等于11、22、33的数据</span></div><div class="line"><span class="comment"># models.Tb1.objects.exclude(id__in=[11, 22, 33])  # not in</span></div><div class="line"></div><div class="line"><span class="comment"># isnull</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__isnull=True)</span></div><div class="line"></div><div class="line"><span class="comment"># contains</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name__contains="ven")</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name__icontains="ven") # icontains大小写不敏感</span></div><div class="line"><span class="comment"># models.Tb1.objects.exclude(name__icontains="ven")</span></div><div class="line"></div><div class="line"><span class="comment"># range</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(id__range=[1, 2])   # 范围bettwen and</span></div><div class="line"></div><div class="line"><span class="comment"># 其他类似</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># startswith，istartswith, endswith, iendswith,</span></div><div class="line"></div><div class="line"><span class="comment"># order by</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').order_by('id')    # asc</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').order_by('-id')   # desc</span></div><div class="line"></div><div class="line"><span class="comment"># group by</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># from django.db.models import Count, Min, Max, Sum</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(c1=1).values('id').annotate(c=Count('num'))</span></div><div class="line"><span class="comment"># SELECT "app01_tb1"."id", COUNT("app01_tb1"."num") AS "c" FROM "app01_tb1" WHERE "app01_tb1"."c1" = 1 GROUP BY "app01_tb1"."id"</span></div><div class="line"></div><div class="line"><span class="comment"># limit 、offset</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.all()[10:20]</span></div><div class="line"></div><div class="line"><span class="comment"># regex正则匹配，iregex 不区分大小写</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.get(title__regex=r'^(An?|The) +')</span></div><div class="line"><span class="comment"># Entry.objects.get(title__iregex=r'^(an?|the) +')</span></div><div class="line"></div><div class="line"><span class="comment"># date</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__date=datetime.date(2005, 1, 1))</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__date__gt=datetime.date(2005, 1, 1))</span></div><div class="line"></div><div class="line"><span class="comment"># year</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__year=2005)</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__year__gte=2005)</span></div><div class="line"></div><div class="line"><span class="comment"># month</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__month=12)</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__month__gte=6)</span></div><div class="line"></div><div class="line"><span class="comment"># day</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__day=3)</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__day__gte=3)</span></div><div class="line"></div><div class="line"><span class="comment"># week_day</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__week_day=2)</span></div><div class="line"><span class="comment"># Entry.objects.filter(pub_date__week_day__gte=2)</span></div><div class="line"></div><div class="line"><span class="comment"># hour</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__hour=23)</span></div><div class="line"><span class="comment"># Event.objects.filter(time__hour=5)</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__hour__gte=12)</span></div><div class="line"></div><div class="line"><span class="comment"># minute</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__minute=29)</span></div><div class="line"><span class="comment"># Event.objects.filter(time__minute=46)</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__minute__gte=29)</span></div><div class="line"></div><div class="line"><span class="comment"># second</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__second=31)</span></div><div class="line"><span class="comment"># Event.objects.filter(time__second=2)</span></div><div class="line"><span class="comment"># Event.objects.filter(timestamp__second__gte=31)</span></div></pre></td></tr></table></figure>
<h5 id="3、其他操作"><a href="#3、其他操作" class="headerlink" title="3、其他操作"></a>3、其他操作</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># extra</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># extra(self, select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</span></div><div class="line"><span class="comment">#    Entry.objects.extra(select=&#123;'new_id': "select col from sometable where othercol &gt; %s"&#125;, select_params=(1,))</span></div><div class="line"><span class="comment">#    Entry.objects.extra(where=['headline=%s'], params=['Lennon'])</span></div><div class="line"><span class="comment">#    Entry.objects.extra(where=["foo='a' OR bar = 'a'", "baz = 'a'"])</span></div><div class="line"><span class="comment">#    Entry.objects.extra(select=&#123;'new_id': "select id from tb where id &gt; %s"&#125;, select_params=(1,), order_by=['-nid'])</span></div><div class="line"></div><div class="line"><span class="comment"># F</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># from django.db.models import F</span></div><div class="line"><span class="comment"># models.Tb1.objects.update(num=F('num')+1)</span></div><div class="line"></div><div class="line"><span class="comment"># Q</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># 方式一：</span></div><div class="line"><span class="comment"># Q(nid__gt=10)</span></div><div class="line"><span class="comment"># Q(nid=8) | Q(nid__gt=10)</span></div><div class="line"><span class="comment"># Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption='root')</span></div><div class="line"><span class="comment"># 方式二：</span></div><div class="line"><span class="comment"># con = Q()</span></div><div class="line"><span class="comment"># q1 = Q()</span></div><div class="line"><span class="comment"># q1.connector = 'OR'</span></div><div class="line"><span class="comment"># q1.children.append(('id', 1))</span></div><div class="line"><span class="comment"># q1.children.append(('id', 10))</span></div><div class="line"><span class="comment"># q1.children.append(('id', 9))</span></div><div class="line"><span class="comment"># q2 = Q()</span></div><div class="line"><span class="comment"># q2.connector = 'OR'</span></div><div class="line"><span class="comment"># q2.children.append(('c1', 1))</span></div><div class="line"><span class="comment"># q2.children.append(('c1', 10))</span></div><div class="line"><span class="comment"># q2.children.append(('c1', 9))</span></div><div class="line"><span class="comment"># con.add(q1, 'AND')</span></div><div class="line"><span class="comment"># con.add(q2, 'AND')</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># models.Tb1.objects.filter(con)</span></div><div class="line"></div><div class="line"><span class="comment"># 执行原生SQL</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># from django.db import connection, connections</span></div><div class="line"><span class="comment"># cursor = connection.cursor()  # cursor = connections['default'].cursor()</span></div><div class="line"><span class="comment"># cursor.execute("""SELECT * from auth_user where id = %s""", [1])</span></div><div class="line"><span class="comment"># row = cursor.fetchone()</span></div></pre></td></tr></table></figure>
<h5 id="4、连表操作（了不起的双下划线）"><a href="#4、连表操作（了不起的双下划线）" class="headerlink" title="4、连表操作（了不起的双下划线）"></a>4、连表操作（了不起的双下划线）</h5><p>利用双下划线和 _set 将表之间的操作连接起来</p>
<p> 表结构实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span><span class="params">(models.Model)</span>:</span></div><div class="line">    user_info = models.OneToOneField(<span class="string">'UserInfo'</span>)</div><div class="line">    username = models.CharField(max_length=<span class="number">64</span>)</div><div class="line">    password = models.CharField(max_length=<span class="number">64</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.username</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></div><div class="line">    user_type_choice = (</div><div class="line">        (<span class="number">0</span>, <span class="string">u'普通用户'</span>),</div><div class="line">        (<span class="number">1</span>, <span class="string">u'高级用户'</span>),</div><div class="line">    )</div><div class="line">    user_type = models.IntegerField(choices=user_type_choice)</div><div class="line">    name = models.CharField(max_length=<span class="number">32</span>)</div><div class="line">    email = models.CharField(max_length=<span class="number">32</span>)</div><div class="line">    address = models.CharField(max_length=<span class="number">128</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.name</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroup</span><span class="params">(models.Model)</span>:</span></div><div class="line"></div><div class="line">    caption = models.CharField(max_length=<span class="number">64</span>)</div><div class="line"></div><div class="line">    user_info = models.ManyToManyField(<span class="string">'UserInfo'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.caption</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span><span class="params">(models.Model)</span>:</span></div><div class="line">    hostname = models.CharField(max_length=<span class="number">64</span>)</div><div class="line">    ip = models.GenericIPAddressField()</div><div class="line">    user_group = models.ForeignKey(<span class="string">'UserGroup'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.hostname</div></pre></td></tr></table></figure>
<p> 一对一操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">user_info_obj = models.UserInfo.objects.filter(id=<span class="number">1</span>).first()</div><div class="line"><span class="keyword">print</span> user_info_obj.user_type</div><div class="line"><span class="keyword">print</span> user_info_obj.get_user_type_display()</div><div class="line"><span class="keyword">print</span> user_info_obj.userprofile.password</div><div class="line"> </div><div class="line">user_info_obj = models.UserInfo.objects.filter(id=<span class="number">1</span>).values(<span class="string">'email'</span>, <span class="string">'userprofile__username'</span>).first()</div><div class="line"><span class="keyword">print</span> user_info_obj.keys()</div><div class="line"><span class="keyword">print</span> user_info_obj.values()</div></pre></td></tr></table></figure>
<p> 一对多</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">类似一对一</div><div class="line">1、搜索条件使用 __ 连接</div><div class="line">2、获取值时使用 .    连接</div></pre></td></tr></table></figure>
<p> 多对多操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">user_info_obj = models.UserInfo.objects.get(name=<span class="string">u'武沛齐'</span>)</div><div class="line">user_info_objs = models.UserInfo.objects.all()</div><div class="line"> </div><div class="line">group_obj = models.UserGroup.objects.get(caption=<span class="string">'CEO'</span>)</div><div class="line">group_objs = models.UserGroup.objects.all()</div><div class="line"> </div><div class="line"><span class="comment"># 添加数据</span></div><div class="line"><span class="comment">#group_obj.user_info.add(user_info_obj)</span></div><div class="line"><span class="comment">#group_obj.user_info.add(*user_info_objs)</span></div><div class="line"> </div><div class="line"><span class="comment"># 删除数据</span></div><div class="line"><span class="comment">#group_obj.user_info.remove(user_info_obj)</span></div><div class="line"><span class="comment">#group_obj.user_info.remove(*user_info_objs)</span></div><div class="line"> </div><div class="line"><span class="comment"># 添加数据</span></div><div class="line"><span class="comment">#user_info_obj.usergroup_set.add(group_obj)</span></div><div class="line"><span class="comment">#user_info_obj.usergroup_set.add(*group_objs)</span></div><div class="line"> </div><div class="line"><span class="comment"># 删除数据</span></div><div class="line"><span class="comment">#user_info_obj.usergroup_set.remove(group_obj)</span></div><div class="line"><span class="comment">#user_info_obj.usergroup_set.remove(*group_objs)</span></div><div class="line"> </div><div class="line"><span class="comment"># 获取数据</span></div><div class="line"><span class="comment">#print group_obj.user_info.all()</span></div><div class="line"><span class="comment">#print group_obj.user_info.all().filter(id=1)</span></div><div class="line"> </div><div class="line"><span class="comment"># 获取数据</span></div><div class="line"><span class="comment">#print user_info_obj.usergroup_set.all()</span></div><div class="line"><span class="comment">#print user_info_obj.usergroup_set.all().filter(caption='CEO')</span></div><div class="line"><span class="comment">#print user_info_obj.usergroup_set.all().filter(caption='DBA')</span></div></pre></td></tr></table></figure>
<p><strong>扩展：</strong></p>
<p>a、自定义上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">(request)</span>:</span></div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</div><div class="line">        obj = request.FILES.get(<span class="string">'fafafa'</span>)</div><div class="line">        f = open(obj.name, <span class="string">'wb'</span>)</div><div class="line">        <span class="keyword">for</span> chunk <span class="keyword">in</span> obj.chunks():</div><div class="line">            f.write(chunk)</div><div class="line">        f.close()</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'file.html'</span>)</div></pre></td></tr></table></figure>
<p>b、Form上传文件实例</p>
<p>Form</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileForm</span><span class="params">(forms.Form)</span>:</span></div><div class="line">    ExcelFile = forms.FileField()</div></pre></td></tr></table></figure>
<p>Model</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadFile</span><span class="params">(models.Model)</span>:</span></div><div class="line">    userid = models.CharField(max_length = <span class="number">30</span>)</div><div class="line">    file = models.FileField(upload_to = <span class="string">'./upload/'</span>)</div><div class="line">    date = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>View</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">UploadFile</span><span class="params">(request)</span>:</span></div><div class="line">    uf = AssetForm.FileForm(request.POST,request.FILES)</div><div class="line">    <span class="keyword">if</span> uf.is_valid():</div><div class="line">            upload = models.UploadFile()</div><div class="line">            upload.userid = <span class="number">1</span></div><div class="line">            upload.file = uf.cleaned_data[<span class="string">'ExcelFile'</span>]</div><div class="line">            upload.save()</div><div class="line">            </div><div class="line">            <span class="keyword">print</span> upload.file</div></pre></td></tr></table></figure>
<h3 id="Form"><a href="#Form" class="headerlink" title="Form"></a>Form</h3><p>django中的Form一般有两种功能：</p>
<ul>
<li>输入html</li>
<li>验证用户输入</li>
</ul>
<p>Form</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</div><div class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mobile_validate</span><span class="params">(value)</span>:</span></div><div class="line">    mobile_re = re.compile(<span class="string">r'^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]&#123;8&#125;$'</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> mobile_re.match(value):</div><div class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'手机号码格式错误'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PublishForm</span><span class="params">(forms.Form)</span>:</span></div><div class="line"></div><div class="line">    user_type_choice = (</div><div class="line">        (<span class="number">0</span>, <span class="string">u'普通用户'</span>),</div><div class="line">        (<span class="number">1</span>, <span class="string">u'高级用户'</span>),</div><div class="line">    )</div><div class="line"></div><div class="line">    user_type = forms.IntegerField(widget=forms.widgets.Select(choices=user_type_choice,</div><div class="line">                                                                  attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>&#125;))</div><div class="line"></div><div class="line">    title = forms.CharField(max_length=<span class="number">20</span>,</div><div class="line">                            min_length=<span class="number">5</span>,</div><div class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'标题不能为空'</span>,</div><div class="line">                                            <span class="string">'min_length'</span>: <span class="string">u'标题最少为5个字符'</span>,</div><div class="line">                                            <span class="string">'max_length'</span>: <span class="string">u'标题最多为20个字符'</span>&#125;,</div><div class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>,</div><div class="line">                                                          <span class="string">'placeholder'</span>: <span class="string">u'标题5-20个字符'</span>&#125;))</div><div class="line"></div><div class="line">    memo = forms.CharField(required=<span class="keyword">False</span>,</div><div class="line">                           max_length=<span class="number">256</span>,</div><div class="line">                           widget=forms.widgets.Textarea(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control no-radius"</span>, <span class="string">'placeholder'</span>: <span class="string">u'详细描述'</span>, <span class="string">'rows'</span>: <span class="number">3</span>&#125;))</div><div class="line"></div><div class="line">    phone = forms.CharField(validators=[mobile_validate, ],</div><div class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'手机不能为空'</span>&#125;,</div><div class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>,</div><div class="line">                                                          <span class="string">'placeholder'</span>: <span class="string">u'手机号码'</span>&#125;))</div><div class="line"></div><div class="line">    email = forms.EmailField(required=<span class="keyword">False</span>,</div><div class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'邮箱不能为空'</span>,<span class="string">'invalid'</span>: <span class="string">u'邮箱格式错误'</span>&#125;,</div><div class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>, <span class="string">'placeholder'</span>: <span class="string">u'邮箱'</span>&#125;))</div></pre></td></tr></table></figure>
<p>View</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span><span class="params">(request)</span>:</span></div><div class="line">    ret = &#123;<span class="string">'status'</span>: <span class="keyword">False</span>, <span class="string">'data'</span>: <span class="string">''</span>, <span class="string">'error'</span>: <span class="string">''</span>, <span class="string">'summary'</span>: <span class="string">''</span>&#125;</div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        request_form = PublishForm(request.POST)</div><div class="line">        <span class="keyword">if</span> request_form.is_valid():</div><div class="line">            request_dict = request_form.clean()</div><div class="line">            <span class="keyword">print</span> request_dict</div><div class="line">            ret[<span class="string">'status'</span>] = <span class="keyword">True</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            error_msg = request_form.errors.as_json()</div><div class="line">            ret[<span class="string">'error'</span>] = json.loads(error_msg)</div><div class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(ret))</div></pre></td></tr></table></figure>
<p><strong>扩展：ModelForm</strong></p>
<p>在使用Model和Form时，都需要对字段进行定义并指定类型，通过ModelForm则可以省去From中字段的定义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminModelForm</span><span class="params">(forms.ModelForm)</span>:</span></div><div class="line">      </div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        model = models.Admin</div><div class="line">        <span class="comment">#fields = '__all__'</span></div><div class="line">        fields = (<span class="string">'username'</span>, <span class="string">'email'</span>)</div><div class="line">          </div><div class="line">        widgets = &#123;</div><div class="line">            <span class="string">'email'</span> : forms.PasswordInput(attrs=&#123;<span class="string">'class'</span>:<span class="string">"alex"</span>&#125;),</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h3 id="跨站请求伪造"><a href="#跨站请求伪造" class="headerlink" title="跨站请求伪造"></a>跨站请求伪造</h3><h4 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h4><p>django为用户实现防止跨站请求伪造的功能，通过中间件 django.middleware.csrf.CsrfViewMiddleware 来完成。而对于django中设置防跨站请求伪造功能有分为全局和局部。</p>
<p>全局：</p>
<p>　　中间件 django.middleware.csrf.CsrfViewMiddleware</p>
<p>局部：</p>
<ul>
<li>@csrf_protect，为当前函数强制设置防跨站请求伪造功能，即便settings中没有设置全局中间件。</li>
<li>@csrf_exempt，取消当前函数防跨站请求伪造功能，即便settings中设置了全局中间件。</li>
</ul>
<p>注：from django.views.decorators.csrf import csrf_exempt,csrf_protect</p>
<h4 id="二、应用"><a href="#二、应用" class="headerlink" title="二、应用"></a>二、应用</h4><p>1、普通表单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">veiw中设置返回值：</div><div class="line">　　<span class="keyword">return</span> render_to_response(<span class="string">'Account/Login.html'</span>,data,context_instance=RequestContext(request))　　</div><div class="line">     或者</div><div class="line">     <span class="keyword">return</span> render(request, <span class="string">'xxx.html'</span>, data)</div><div class="line">  </div><div class="line">html中设置Token:</div><div class="line">　　&#123;% csrf_token %&#125;</div></pre></td></tr></table></figure>
<p>2、Ajax</p>
<p>对于传统的form，可以通过表单的方式将token再次发送到服务端，而对于ajax的话，使用如下方式。</p>
<p>view.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.template.context <span class="keyword">import</span> RequestContext</div><div class="line"><span class="comment"># Create your views here.</span></div><div class="line">  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></div><div class="line">  </div><div class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">        <span class="keyword">print</span> request.POST</div><div class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</div><div class="line">    <span class="keyword">return</span>  render_to_response(<span class="string">'app01/test.html'</span>,context_instance=RequestContext(request))</div></pre></td></tr></table></figure>
<p>text.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    &#123;% csrf_token %&#125;</div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"Do();"</span>  <span class="attr">value</span>=<span class="string">"Do it"</span>/&gt;</span></div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/plugin/jquery/jquery-1.8.0.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/static/plugin/jquery/jquery.cookie.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">        var csrftoken = $.cookie('csrftoken');</div><div class="line">  </div><div class="line">        function csrfSafeMethod(method) &#123;</div><div class="line">            // these HTTP methods do not require CSRF protection</div><div class="line">            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));</div><div class="line">        &#125;</div><div class="line">        $.ajaxSetup(&#123;</div><div class="line">            beforeSend: function(xhr, settings) &#123;</div><div class="line">                if (!csrfSafeMethod(settings.type) &amp;&amp; !this.crossDomain) &#123;</div><div class="line">                    xhr.setRequestHeader("X-CSRFToken", csrftoken);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        function Do()&#123;</div><div class="line">  </div><div class="line">            $.ajax(&#123;</div><div class="line">                url:"/app01/test/",</div><div class="line">                data:&#123;id:1&#125;,</div><div class="line">                type:'POST',</div><div class="line">                success:function(data)&#123;</div><div class="line">                    console.log(data);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">  </div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>更多：<a href="https://docs.djangoproject.com/en/dev/ref/csrf/#ajax" target="_blank" rel="external">https://docs.djangoproject.com/en/dev/ref/csrf/#ajax</a></p>
<h3 id="Cookei"><a href="#Cookei" class="headerlink" title="Cookei"></a>Cookei</h3><h4 id="1、获取Cookie："><a href="#1、获取Cookie：" class="headerlink" title="1、获取Cookie："></a>1、获取Cookie：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">request.COOKIES[<span class="string">'key'</span>]</div><div class="line">request.get_signed_cookie(key, default=RAISE_ERROR, salt=<span class="string">''</span>, max_age=<span class="keyword">None</span>)</div><div class="line">    参数：</div><div class="line">        default: 默认值</div><div class="line">           salt: 加密盐</div><div class="line">        max_age: 后台控制过期时间</div></pre></td></tr></table></figure>
<h4 id="2、设置Cookie："><a href="#2、设置Cookie：" class="headerlink" title="2、设置Cookie："></a>2、设置Cookie：</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">rep = HttpResponse(...) 或 rep ＝ render(request, ...)</div><div class="line"> </div><div class="line">rep.set_cookie(key,value,...)</div><div class="line">rep.set_signed_cookie(key,value,salt='加密盐',...)</div><div class="line">    参数：</div><div class="line">        key,              键</div><div class="line">        value='',         值</div><div class="line">        max_age=None,     超时时间</div><div class="line">        expires=None,     超时时间(IE requires expires, so set it if hasn't been already.)</div><div class="line">        path='/',         Cookie生效的路径，/ 表示根路径，特殊的：跟路径的cookie可以被任何url的页面访问</div><div class="line">        domain=None,      Cookie生效的域名</div><div class="line">        secure=False,     https传输</div><div class="line">        httponly=False    只能http协议传输，无法被JavaScript获取（不是绝对，底层抓包可以获取到也可以被覆盖）</div></pre></td></tr></table></figure>
<p>由于cookie保存在客户端的电脑上，所以，JavaScript和jquery也可以操作cookie。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/static/js/jquery.cookie.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">$.cookie("list_pager_num", 30,&#123; path: '/' &#125;);</div><div class="line">Session</div></pre></td></tr></table></figure>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>Django中默认支持Session，其内部提供了5种类型的Session供开发者使用：</p>
<ul>
<li>数据库（默认）</li>
<li>缓存</li>
<li>文件</li>
<li>缓存+数据库</li>
<li>加密cookie</li>
</ul>
<p>1、数据库Session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">Django默认支持Session，并且默认是将Session数据存储在数据库中，即：django_session 表中。</div><div class="line"> </div><div class="line">a. 配置 settings.py</div><div class="line"> </div><div class="line">    SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.db'</span>   <span class="comment"># 引擎（默认）</span></div><div class="line">     </div><div class="line">    SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                       <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串（默认）</span></div><div class="line">    SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                               <span class="comment"># Session的cookie保存的路径（默认）</span></div><div class="line">    SESSION_COOKIE_DOMAIN = <span class="keyword">None</span>                             <span class="comment"># Session的cookie保存的域名（默认）</span></div><div class="line">    SESSION_COOKIE_SECURE = <span class="keyword">False</span>                            <span class="comment"># 是否Https传输cookie（默认）</span></div><div class="line">    SESSION_COOKIE_HTTPONLY = <span class="keyword">True</span>                           <span class="comment"># 是否Session的cookie只支持http传输（默认）</span></div><div class="line">    SESSION_COOKIE_AGE = <span class="number">1209600</span>                             <span class="comment"># Session的cookie失效日期（2周）（默认）</span></div><div class="line">    SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="keyword">False</span>                  <span class="comment"># 是否关闭浏览器使得Session过期（默认）</span></div><div class="line">    SESSION_SAVE_EVERY_REQUEST = <span class="keyword">False</span>                       <span class="comment"># 是否每次请求都保存Session，默认修改之后才保存（默认）</span></div><div class="line"> </div><div class="line">b. 使用</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">        <span class="comment"># 获取、设置、删除Session中数据</span></div><div class="line">        request.session[<span class="string">'k1'</span>]</div><div class="line">        request.session.get(<span class="string">'k1'</span>,<span class="keyword">None</span>)</div><div class="line">        request.session[<span class="string">'k1'</span>] = <span class="number">123</span></div><div class="line">        request.session.setdefault(<span class="string">'k1'</span>,<span class="number">123</span>) <span class="comment"># 存在则不设置</span></div><div class="line">        <span class="keyword">del</span> request.session[<span class="string">'k1'</span>]</div><div class="line"> </div><div class="line">        <span class="comment"># 所有 键、值、键值对</span></div><div class="line">        request.session.keys()</div><div class="line">        request.session.values()</div><div class="line">        request.session.items()</div><div class="line">        request.session.iterkeys()</div><div class="line">        request.session.itervalues()</div><div class="line">        request.session.iteritems()</div><div class="line"> </div><div class="line">        <span class="comment"># 用户session的随机字符串</span></div><div class="line">        request.session.session_key</div><div class="line"> </div><div class="line">        <span class="comment"># 将所有Session失效日期小于当前日期的数据删除</span></div><div class="line">        request.session.clear_expired()</div><div class="line"> </div><div class="line">        <span class="comment"># 检查 用户session的随机字符串 在数据库中是否</span></div><div class="line">        request.session.exists(<span class="string">"session_key"</span>)</div><div class="line"> </div><div class="line">        <span class="comment"># 删除当前用户的所有Session数据</span></div><div class="line">        request.session.delete(<span class="string">"session_key"</span>)</div><div class="line"> </div><div class="line">        request.session.set_expiry(value)</div><div class="line">            * 如果value是个整数，session会在些秒数后失效。</div><div class="line">            * 如果value是个datatime或timedelta，session就会在这个时间后失效。</div><div class="line">            * 如果value是<span class="number">0</span>,用户关闭浏览器session就会失效。</div><div class="line">            * 如果value是<span class="keyword">None</span>,session会依赖全局session失效策略。</div></pre></td></tr></table></figure>
<p>2、缓存Session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">a. 配置 settings.py</div><div class="line"> </div><div class="line">    SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span>  <span class="comment"># 引擎</span></div><div class="line">    SESSION_CACHE_ALIAS = <span class="string">'default'</span>                            <span class="comment"># 使用的缓存别名（默认内存缓存，也可以是memcache），此处别名依赖缓存的设置</span></div><div class="line"> </div><div class="line">    SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                        <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span></div><div class="line">    SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                                <span class="comment"># Session的cookie保存的路径</span></div><div class="line">    SESSION_COOKIE_DOMAIN = <span class="keyword">None</span>                              <span class="comment"># Session的cookie保存的域名</span></div><div class="line">    SESSION_COOKIE_SECURE = <span class="keyword">False</span>                             <span class="comment"># 是否Https传输cookie</span></div><div class="line">    SESSION_COOKIE_HTTPONLY = <span class="keyword">True</span>                            <span class="comment"># 是否Session的cookie只支持http传输</span></div><div class="line">    SESSION_COOKIE_AGE = <span class="number">1209600</span>                              <span class="comment"># Session的cookie失效日期（2周）</span></div><div class="line">    SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="keyword">False</span>                   <span class="comment"># 是否关闭浏览器使得Session过期</span></div><div class="line">    SESSION_SAVE_EVERY_REQUEST = <span class="keyword">False</span>                        <span class="comment"># 是否每次请求都保存Session，默认修改之后才保存</span></div><div class="line"> </div><div class="line">b. 使用</div><div class="line"> </div><div class="line">    同上</div></pre></td></tr></table></figure>
<p>3、文件Session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">a. 配置 settings.py</div><div class="line"> </div><div class="line">    SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.file'</span>    <span class="comment"># 引擎</span></div><div class="line">    SESSION_FILE_PATH = <span class="keyword">None</span>                                    <span class="comment"># 缓存文件路径，如果为None，则使用tempfile模块获取一个临时地址tempfile.gettempdir()                                                            # 如：/var/folders/d3/j9tj0gz93dg06bmwxmhh6_xm0000gn/T</span></div><div class="line"> </div><div class="line">    SESSION_COOKIE_NAME ＝ <span class="string">"sessionid"</span>                          <span class="comment"># Session的cookie保存在浏览器上时的key，即：sessionid＝随机字符串</span></div><div class="line">    SESSION_COOKIE_PATH ＝ <span class="string">"/"</span>                                  <span class="comment"># Session的cookie保存的路径</span></div><div class="line">    SESSION_COOKIE_DOMAIN = <span class="keyword">None</span>                                <span class="comment"># Session的cookie保存的域名</span></div><div class="line">    SESSION_COOKIE_SECURE = <span class="keyword">False</span>                               <span class="comment"># 是否Https传输cookie</span></div><div class="line">    SESSION_COOKIE_HTTPONLY = <span class="keyword">True</span>                              <span class="comment"># 是否Session的cookie只支持http传输</span></div><div class="line">    SESSION_COOKIE_AGE = <span class="number">1209600</span>                                <span class="comment"># Session的cookie失效日期（2周）</span></div><div class="line">    SESSION_EXPIRE_AT_BROWSER_CLOSE = <span class="keyword">False</span>                     <span class="comment"># 是否关闭浏览器使得Session过期</span></div><div class="line">    SESSION_SAVE_EVERY_REQUEST = <span class="keyword">False</span>                          <span class="comment"># 是否每次请求都保存Session，默认修改之后才保存</span></div><div class="line"> </div><div class="line">b. 使用</div><div class="line"> </div><div class="line">    同上</div></pre></td></tr></table></figure>
<p>4、缓存+数据库Session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">数据库用于做持久化，缓存用于提高效率</div><div class="line"> </div><div class="line">a. 配置 settings.py</div><div class="line"> </div><div class="line">    SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cached_db'</span>        <span class="comment"># 引擎</span></div><div class="line"> </div><div class="line">b. 使用</div><div class="line"> </div><div class="line">    同上</div></pre></td></tr></table></figure>
<p>5、加密cookie Session</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a. 配置 settings.py</div><div class="line">     </div><div class="line">    SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.signed_cookies'</span>   <span class="comment"># 引擎</span></div><div class="line"> </div><div class="line">b. 使用</div><div class="line"> </div><div class="line">    同上</div></pre></td></tr></table></figure>
<p>更多参考：<a href="https://docs.djangoproject.com/en/1.9/topics/http/sessions/" target="_blank" rel="external">猛击这里</a> 和 <a href="https://docs.djangoproject.com/en/1.9/ref/settings/#settings-sessions" target="_blank" rel="external">猛击这里</a></p>
<p><strong>扩展：Session用户验证</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(func)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(request, *args, **kwargs)</span>:</span></div><div class="line">        <span class="comment"># 如果未登陆，跳转到指定页面</span></div><div class="line">        <span class="keyword">if</span> request.path == <span class="string">'/test/'</span>:</div><div class="line">            <span class="keyword">return</span> redirect(<span class="string">'http://www.baidu.com'</span>)</div><div class="line">        <span class="keyword">return</span> func(request, *args, **kwargs)</div><div class="line">    <span class="keyword">return</span> wrap</div></pre></td></tr></table></figure>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><h4 id="一、Django内置分页"><a href="#一、Django内置分页" class="headerlink" title="一、Django内置分页"></a>一、Django内置分页</h4><p> views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</div><div class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</div><div class="line"></div><div class="line">L = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">999</span>):</div><div class="line">    L.append(i)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">    current_page = request.GET.get(<span class="string">'p'</span>)</div><div class="line"></div><div class="line">    paginator = Paginator(L, <span class="number">10</span>)</div><div class="line">    <span class="comment"># per_page: 每页显示条目数量</span></div><div class="line">    <span class="comment"># count:    数据总个数</span></div><div class="line">    <span class="comment"># num_pages:总页数</span></div><div class="line">    <span class="comment"># page_range:总页数的索引范围，如: (1,10),(1,200)</span></div><div class="line">    <span class="comment"># page:     page对象</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        posts = paginator.page(current_page)</div><div class="line">        <span class="comment"># has_next              是否有下一页</span></div><div class="line">        <span class="comment"># next_page_number      下一页页码</span></div><div class="line">        <span class="comment"># has_previous          是否有上一页</span></div><div class="line">        <span class="comment"># previous_page_number  上一页页码</span></div><div class="line">        <span class="comment"># object_list           分页之后的数据列表</span></div><div class="line">        <span class="comment"># number                当前页</span></div><div class="line">        <span class="comment"># paginator             paginator对象</span></div><div class="line">    <span class="keyword">except</span> PageNotAnInteger:</div><div class="line">        posts = paginator.page(<span class="number">1</span>)</div><div class="line">    <span class="keyword">except</span> EmptyPage:</div><div class="line">        posts = paginator.page(paginator.num_pages)</div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'posts'</span>: posts&#125;)</div></pre></td></tr></table></figure>
<p> Html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">    &#123;% for item in posts %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;% endfor %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"step-links"</span>&gt;</span></div><div class="line">        &#123;% if posts.has_previous %&#125;</div><div class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?p=&#123;&#123; posts.previous_page_number &#125;&#125;"</span>&gt;</span>Previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        &#123;% endif %&#125;</div><div class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"current"</span>&gt;</span></div><div class="line">            Page &#123;&#123; posts.number &#125;&#125; of &#123;&#123; posts.paginator.num_pages &#125;&#125;.</div><div class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">          &#123;% if posts.has_next %&#125;</div><div class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?p=&#123;&#123; posts.next_page_number &#125;&#125;"</span>&gt;</span>Next<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">          &#123;% endif %&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 扩展内置分页：views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</div><div class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPaginator</span><span class="params">(Paginator)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, current_page, max_pager_num, *args, **kwargs)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        :param current_page: 当前页</div><div class="line">        :param max_pager_num:最多显示的页码个数</div><div class="line">        :param args:</div><div class="line">        :param kwargs:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        self.current_page = int(current_page)</div><div class="line">        self.max_pager_num = max_pager_num</div><div class="line">        super(CustomPaginator, self).__init__(*args, **kwargs)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_num_range</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># 当前页面</span></div><div class="line">        <span class="comment"># self.current_page</span></div><div class="line">        <span class="comment"># 总页数</span></div><div class="line">        <span class="comment"># self.num_pages</span></div><div class="line">        <span class="comment"># 最多显示的页码个数</span></div><div class="line">        <span class="comment"># self.max_pager_num</span></div><div class="line">        print(<span class="number">1</span>)</div><div class="line">        <span class="keyword">if</span> self.num_pages &lt; self.max_pager_num:</div><div class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.num_pages + <span class="number">1</span>)</div><div class="line">        print(<span class="number">2</span>)</div><div class="line">        part = int(self.max_pager_num / <span class="number">2</span>)</div><div class="line">        <span class="keyword">if</span> self.current_page - part &lt; <span class="number">1</span>:</div><div class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.max_pager_num + <span class="number">1</span>)</div><div class="line">        print(<span class="number">3</span>)</div><div class="line">        <span class="keyword">if</span> self.current_page + part &gt; self.num_pages:</div><div class="line">            <span class="keyword">return</span> range(self.num_pages + <span class="number">1</span> - self.max_pager_num, self.num_pages + <span class="number">1</span>)</div><div class="line">        print(<span class="number">4</span>)</div><div class="line">        <span class="keyword">return</span> range(self.current_page - part, self.current_page + part + <span class="number">1</span>)</div><div class="line"></div><div class="line"></div><div class="line">L = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">999</span>):</div><div class="line">    L.append(i)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></div><div class="line">    current_page = request.GET.get(<span class="string">'p'</span>)</div><div class="line">    paginator = CustomPaginator(current_page, <span class="number">11</span>, L, <span class="number">10</span>)</div><div class="line">    <span class="comment"># per_page: 每页显示条目数量</span></div><div class="line">    <span class="comment"># count:    数据总个数</span></div><div class="line">    <span class="comment"># num_pages:总页数</span></div><div class="line">    <span class="comment"># page_range:总页数的索引范围，如: (1,10),(1,200)</span></div><div class="line">    <span class="comment"># page:     page对象</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        posts = paginator.page(current_page)</div><div class="line">        <span class="comment"># has_next              是否有下一页</span></div><div class="line">        <span class="comment"># next_page_number      下一页页码</span></div><div class="line">        <span class="comment"># has_previous          是否有上一页</span></div><div class="line">        <span class="comment"># previous_page_number  上一页页码</span></div><div class="line">        <span class="comment"># object_list           分页之后的数据列表</span></div><div class="line">        <span class="comment"># number                当前页</span></div><div class="line">        <span class="comment"># paginator             paginator对象</span></div><div class="line">    <span class="keyword">except</span> PageNotAnInteger:</div><div class="line">        posts = paginator.page(<span class="number">1</span>)</div><div class="line">    <span class="keyword">except</span> EmptyPage:</div><div class="line">        posts = paginator.page(paginator.num_pages)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'posts'</span>: posts&#125;)</div></pre></td></tr></table></figure>
<p> 扩展内置分页：Html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">    &#123;% for item in posts %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    &#123;% endfor %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"step-links"</span>&gt;</span></div><div class="line">&#123;% if posts.has_previous %&#125;</div><div class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?p=&#123;&#123; posts.previous_page_number &#125;&#125;"</span>&gt;</span>Previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">&#123;% endif %&#125;</div><div class="line"></div><div class="line">    &#123;% for i in posts.paginator.page_num_range %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?p=&#123;&#123; i &#125;&#125;"</span>&gt;</span>&#123;&#123; i &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    &#123;% endfor %&#125;</div><div class="line"></div><div class="line">    &#123;% if posts.has_next %&#125;</div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?p=&#123;&#123; posts.next_page_number &#125;&#125;"</span>&gt;</span>Next<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    &#123;% endif %&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"current"</span>&gt;</span></div><div class="line">Page &#123;&#123; posts.number &#125;&#125; of &#123;&#123; posts.paginator.num_pages &#125;&#125;.</div><div class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="二、自定义分页"><a href="#二、自定义分页" class="headerlink" title="二、自定义分页"></a>二、自定义分页</h4><p>分页功能在每个网站都是必要的，对于分页来说，其实就是根据用户的输入计算出应该在数据库表中的起始位置。</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页…）</p>
<p>3、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>4、在数据表中根据起始位置取值，页面上输出数据</p>
<hr>
<p>需求又来了，需要在页面上显示分页的页面。如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<p>1、设定每页显示数据条数</p>
<p>2、用户输入页码（第一页、第二页…）</p>
<p>3、设定显示多少页号</p>
<p>4、获取当前数据总条数</p>
<p>5、根据设定显示多少页号和数据总条数计算出，总页数</p>
<p>6、根据设定的每页显示条数和当前页码，计算出需要取数据表的起始位置</p>
<p>7、在数据表中根据起始位置取值，页面上输出数据</p>
<p>8、输出分页html，如：［上一页］［1］［2］［3］［4］［5］［下一页］</p>
<p>分页实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># _*_coding:utf-8_*_</span></div><div class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageInfo</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,current,totalItem,peritems=<span class="number">5</span>)</span>:</span></div><div class="line">        self.__current=current</div><div class="line">        self.__peritems=peritems</div><div class="line">        self.__totalItem=totalItem</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">From</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> (self.__current<span class="number">-1</span>)*self.__peritems</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">To</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.__current*self.__peritems</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">TotalPage</span><span class="params">(self)</span>:</span>  <span class="comment">#总页数</span></div><div class="line">        result=divmod(self.__totalItem,self.__peritems)</div><div class="line">        <span class="keyword">if</span> result[<span class="number">1</span>]==<span class="number">0</span>:</div><div class="line">            <span class="keyword">return</span> result[<span class="number">0</span>]</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> result[<span class="number">0</span>]+<span class="number">1</span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Custompager</span><span class="params">(baseurl,currentPage,totalpage)</span>:</span>  <span class="comment">#基础页，当前页，总页数</span></div><div class="line">    perPager=<span class="number">11</span></div><div class="line">    <span class="comment">#总页数&lt;11</span></div><div class="line">    <span class="comment">#0 -- totalpage</span></div><div class="line">    <span class="comment">#总页数&gt;11</span></div><div class="line">        <span class="comment">#当前页大于5 currentPage-5 -- currentPage+5</span></div><div class="line">            <span class="comment">#currentPage+5是否超过总页数,超过总页数，end就是总页数</span></div><div class="line">        <span class="comment">#当前页小于5 0 -- 11</span></div><div class="line">    begin=<span class="number">0</span></div><div class="line">    end=<span class="number">0</span></div><div class="line">    <span class="keyword">if</span> totalpage &lt;= <span class="number">11</span>:</div><div class="line">        begin=<span class="number">0</span></div><div class="line">        end=totalpage</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">if</span> currentPage&gt;<span class="number">5</span>:</div><div class="line">            begin=currentPage<span class="number">-5</span></div><div class="line">            end=currentPage+<span class="number">5</span></div><div class="line">            <span class="keyword">if</span> end &gt; totalpage:</div><div class="line">                end=totalpage</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            begin=<span class="number">0</span></div><div class="line">            end=<span class="number">11</span></div><div class="line">    pager_list=[]</div><div class="line">    <span class="keyword">if</span> currentPage&lt;=<span class="number">1</span>:</div><div class="line">        first=<span class="string">"&lt;a href=''&gt;首页&lt;/a&gt;"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        first=<span class="string">"&lt;a href='%s%d'&gt;首页&lt;/a&gt;"</span> % (baseurl,<span class="number">1</span>)</div><div class="line">    pager_list.append(first)</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> currentPage&lt;=<span class="number">1</span>:</div><div class="line">        prev=<span class="string">"&lt;a href=''&gt;上一页&lt;/a&gt;"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        prev=<span class="string">"&lt;a href='%s%d'&gt;上一页&lt;/a&gt;"</span> % (baseurl,currentPage<span class="number">-1</span>)</div><div class="line">    pager_list.append(prev)</div><div class="line"> </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(begin+<span class="number">1</span>,end+<span class="number">1</span>):</div><div class="line">        <span class="keyword">if</span> i == currentPage:</div><div class="line">            temp=<span class="string">"&lt;a href='%s%d' class='selected'&gt;%d&lt;/a&gt;"</span> % (baseurl,i,i)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            temp=<span class="string">"&lt;a href='%s%d'&gt;%d&lt;/a&gt;"</span> % (baseurl,i,i)</div><div class="line">        pager_list.append(temp)</div><div class="line">    <span class="keyword">if</span> currentPage&gt;=totalpage:</div><div class="line">        next=<span class="string">"&lt;a href='#'&gt;下一页&lt;/a&gt;"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        next=<span class="string">"&lt;a href='%s%d'&gt;下一页&lt;/a&gt;"</span> % (baseurl,currentPage+<span class="number">1</span>)</div><div class="line">    pager_list.append(next)</div><div class="line">    <span class="keyword">if</span> currentPage&gt;=totalpage:</div><div class="line">        last=<span class="string">"&lt;a href=''&gt;末页&lt;/a&gt;"</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        last=<span class="string">"&lt;a href='%s%d'&gt;末页&lt;/a&gt;"</span> % (baseurl,totalpage)</div><div class="line">    pager_list.append(last)</div><div class="line">    result=<span class="string">''</span>.join(pager_list)</div><div class="line">    <span class="keyword">return</span> mark_safe(result)   <span class="comment">#把字符串转成html语言</span></div></pre></td></tr></table></figure>
<p>总结，分页时需要做三件事：</p>
<ul>
<li>创建处理分页数据的类</li>
<li>根据分页数据获取数据</li>
<li>输出分页HTML，即：［上一页］［1］［2］［3］［4］［5］［下一页］</li>
</ul>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>由于Django是动态网站，所有每次请求均会去数据进行相应的操作，当程序访问量大时，耗时必然会更加明显，最简单解决方式是使用：缓存，缓存将一个某个views的返回值保存至内存或者memcache中，5分钟内再有人来访问时，则不再去执行view中的操作，而是直接从内存或者Redis中之前缓存的内容拿到，并返回。</p>
<p>Django中提供了6种缓存方式：</p>
<ul>
<li>开发调试</li>
<li>内存</li>
<li>文件</li>
<li>数据库</li>
<li>Memcache缓存（python-memcached模块）</li>
<li>Memcache缓存（pylibmc模块）</li>
</ul>
<h4 id="1、配置"><a href="#1、配置" class="headerlink" title="1、配置"></a>1、配置</h4><h5 id="a、开发调试"><a href="#a、开发调试" class="headerlink" title="a、开发调试"></a>a、开发调试</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此为开始调试用，实际内部不做任何操作</span></div><div class="line"><span class="comment"># 配置：</span></div><div class="line">    CACHES = &#123;</div><div class="line">        <span class="string">'default'</span>: &#123;</div><div class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.dummy.DummyCache'</span>,     <span class="comment"># 引擎</span></div><div class="line">            <span class="string">'TIMEOUT'</span>: <span class="number">300</span>,                                               <span class="comment"># 缓存超时时间（默认300，None表示永不过期，0表示立即过期）</span></div><div class="line">            <span class="string">'OPTIONS'</span>:&#123;</div><div class="line">                <span class="string">'MAX_ENTRIES'</span>: <span class="number">300</span>,                                       <span class="comment"># 最大缓存个数（默认300）</span></div><div class="line">                <span class="string">'CULL_FREQUENCY'</span>: <span class="number">3</span>,                                      <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">'KEY_PREFIX'</span>: <span class="string">''</span>,                                             <span class="comment"># 缓存key的前缀（默认空）</span></div><div class="line">            <span class="string">'VERSION'</span>: <span class="number">1</span>,                                                 <span class="comment"># 缓存key的版本（默认1）</span></div><div class="line">            <span class="string">'KEY_FUNCTION'</span> 函数名                                          <span class="comment"># 生成key的函数（默认函数会生成为：【前缀:版本:key】）</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment"># 自定义key</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">default_key_func</span><span class="params">(key, key_prefix, version)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Default function to generate keys.</div><div class="line"></div><div class="line">    Constructs the key used by all other methods. By default it prepends</div><div class="line">    the `key_prefix'. KEY_FUNCTION can be used to specify an alternate</div><div class="line">    function with custom key making behavior.</div><div class="line">    """</div><div class="line">    <span class="keyword">return</span> <span class="string">'%s:%s:%s'</span> % (key_prefix, version, key)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key_func</span><span class="params">(key_func)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Function to decide which key function to use.</div><div class="line"></div><div class="line">    Defaults to ``default_key_func``.</div><div class="line">    """</div><div class="line">    <span class="keyword">if</span> key_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        <span class="keyword">if</span> callable(key_func):</div><div class="line">            <span class="keyword">return</span> key_func</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> import_string(key_func)</div><div class="line">    <span class="keyword">return</span> default_key_func</div></pre></td></tr></table></figure>
<h5 id="b、内存"><a href="#b、内存" class="headerlink" title="b、内存"></a>b、内存</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此缓存将内容保存至内存的变量中</span></div><div class="line"><span class="comment"># 配置：</span></div><div class="line">    CACHES = &#123;</div><div class="line">        <span class="string">'default'</span>: &#123;</div><div class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.locmem.LocMemCache'</span>,</div><div class="line">            <span class="string">'LOCATION'</span>: <span class="string">'unique-snowflake'</span>,</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment"># 注：其他配置同开发调试版本</span></div></pre></td></tr></table></figure>
<h5 id="c、文件"><a href="#c、文件" class="headerlink" title="c、文件"></a>c、文件</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此缓存将内容保存至文件</span></div><div class="line"><span class="comment"># 配置：</span></div><div class="line"></div><div class="line">    CACHES = &#123;</div><div class="line">        <span class="string">'default'</span>: &#123;</div><div class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</div><div class="line">            <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"><span class="comment"># 注：其他配置同开发调试版本</span></div></pre></td></tr></table></figure>
<h5 id="d、数据库"><a href="#d、数据库" class="headerlink" title="d、数据库"></a>d、数据库</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此缓存将内容保存至数据库</span></div><div class="line"></div><div class="line"><span class="comment"># 配置：</span></div><div class="line">    CACHES = &#123;</div><div class="line">        <span class="string">'default'</span>: &#123;</div><div class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.db.DatabaseCache'</span>,</div><div class="line">            <span class="string">'LOCATION'</span>: <span class="string">'my_cache_table'</span>, <span class="comment"># 数据库表</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment"># 注：执行创建表命令 python manage.py createcachetable</span></div></pre></td></tr></table></figure>
<h5 id="e、Memcache缓存（python-memcached模块）"><a href="#e、Memcache缓存（python-memcached模块）" class="headerlink" title="e、Memcache缓存（python-memcached模块）"></a>e、Memcache缓存（python-memcached模块）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此缓存使用python-memcached模块连接memcache</span></div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: <span class="string">'unix:/tmp/memcached.sock'</span>,</div><div class="line">    &#125;</div><div class="line">&#125;   </div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: [</div><div class="line">            <span class="string">'172.19.26.240:11211'</span>,</div><div class="line">            <span class="string">'172.19.26.242:11211'</span>,</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="f、Memcache缓存（pylibmc模块）"><a href="#f、Memcache缓存（pylibmc模块）" class="headerlink" title="f、Memcache缓存（pylibmc模块）"></a>f、Memcache缓存（pylibmc模块）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 此缓存使用pylibmc模块连接memcache</span></div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: <span class="string">'/tmp/memcached.sock'</span>,</div><div class="line">    &#125;</div><div class="line">&#125;   </div><div class="line"></div><div class="line">CACHES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</div><div class="line">        <span class="string">'LOCATION'</span>: [</div><div class="line">            <span class="string">'172.19.26.240:11211'</span>,</div><div class="line">            <span class="string">'172.19.26.242:11211'</span>,</div><div class="line">        ]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2、应用"><a href="#2、应用" class="headerlink" title="2、应用"></a>2、应用</h4><h5 id="a-全站使用"><a href="#a-全站使用" class="headerlink" title="a. 全站使用"></a>a. 全站使用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#使用中间件，经过一系列的认证等操作，如果内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户，当返回给用户之前，判断缓存中是否已经存在，如果不存在则UpdateCacheMiddleware会将缓存保存至缓存，从而实现全站缓存</span></div><div class="line"></div><div class="line"> MIDDLEWARE = [</div><div class="line">     <span class="string">'django.middleware.cache.UpdateCacheMiddleware'</span>,</div><div class="line">     <span class="comment"># 其他中间件...</span></div><div class="line">     <span class="string">'django.middleware.cache.FetchFromCacheMiddleware'</span>,</div><div class="line"> ]</div><div class="line"></div><div class="line"> CACHE_MIDDLEWARE_ALIAS = <span class="string">""</span></div><div class="line"> CACHE_MIDDLEWARE_SECONDS = <span class="string">""</span></div><div class="line"> CACHE_MIDDLEWARE_KEY_PREFIX = <span class="string">""</span></div></pre></td></tr></table></figure>
<h5 id="b-单独视图缓存"><a href="#b-单独视图缓存" class="headerlink" title="b. 单独视图缓存"></a>b. 单独视图缓存</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#方式一：</span></div><div class="line">    <span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</div><div class="line"></div><div class="line"><span class="meta">    @cache_page(60 * 15)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></div><div class="line">        ...</div><div class="line"></div><div class="line"><span class="comment">#方式二：</span></div><div class="line">    <span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</div><div class="line"></div><div class="line">    urlpatterns = [</div><div class="line">        url(<span class="string">r'^foo/([0-9]&#123;1,2&#125;)/$'</span>, cache_page(<span class="number">60</span> * <span class="number">15</span>)(my_view)),</div><div class="line">    ]</div></pre></td></tr></table></figure>
<h5 id="c、局部视图使用"><a href="#c、局部视图使用" class="headerlink" title="c、局部视图使用"></a>c、局部视图使用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#a. 引入TemplateTag</span></div><div class="line"></div><div class="line">    &#123;% load cache %&#125;</div><div class="line"></div><div class="line"><span class="comment">#b. 使用缓存</span></div><div class="line"></div><div class="line">    &#123;% cache <span class="number">5000</span> 缓存key %&#125;</div><div class="line">        缓存内容</div><div class="line">    &#123;% endcache %&#125;</div></pre></td></tr></table></figure>
<p>更多：<a href="https://docs.djangoproject.com/en/1.9/topics/cache/" target="_blank" rel="external">猛击这里</a></p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>关于Django中的序列化主要应用在将数据库中检索的数据返回给客户端用户，特别的Ajax请求一般返回的为Json格式。</p>
<h4 id="1、serializers"><a href="#1、serializers" class="headerlink" title="1、serializers"></a>1、serializers</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> serializers</div><div class="line">ret = models.BookType.objects.all()</div><div class="line">data = serializers.serialize(<span class="string">"json"</span>, ret)</div></pre></td></tr></table></figure>
<h4 id="2、json-dumps"><a href="#2、json-dumps" class="headerlink" title="2、json.dumps"></a>2、json.dumps</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="comment">#ret = models.BookType.objects.all().values('caption')</span></div><div class="line">ret = models.BookType.objects.all().values_list(<span class="string">'caption'</span>)</div><div class="line">ret=list(ret)</div><div class="line">result = json.dumps(ret)</div></pre></td></tr></table></figure>
<p>由于json.dumps时无法处理datetime日期，所以可以通过自定义处理器来做扩展，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json </div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date </div><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime </div><div class="line">   </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">JsonCustomEncoder</span><span class="params">(json.JSONEncoder)</span>:</span> </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default</span><span class="params">(self, field)</span>:</span> </div><div class="line">     </div><div class="line">        <span class="keyword">if</span> isinstance(field, datetime): </div><div class="line">            <span class="keyword">return</span> o.strftime(<span class="string">'%Y-%m-%d %H:%M:%S'</span>) </div><div class="line">        <span class="keyword">elif</span> isinstance(field, date): </div><div class="line">            <span class="keyword">return</span> o.strftime(<span class="string">'%Y-%m-%d'</span>) </div><div class="line">        <span class="keyword">else</span>: </div><div class="line">            <span class="keyword">return</span> json.JSONEncoder.default(self, field) </div><div class="line">   </div><div class="line"><span class="comment"># ds = json.dumps(d, cls=JsonCustomEncoder)</span></div></pre></td></tr></table></figure>
<h3 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h3><p>Django中提供了“信号调度”，用于在框架执行操作时解耦。通俗来讲，就是一些动作发生的时候，信号允许特定的发送者去提醒一些接受者。</p>
<h4 id="1、Django内置信号"><a href="#1、Django内置信号" class="headerlink" title="1、Django内置信号"></a>1、Django内置信号</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">Model signals</div><div class="line">    pre_init                    <span class="comment"># django的modal执行其构造方法前，自动触发</span></div><div class="line">    post_init                   <span class="comment"># django的modal执行其构造方法后，自动触发</span></div><div class="line">    pre_save                    <span class="comment"># django的modal对象保存前，自动触发</span></div><div class="line">    post_save                   <span class="comment"># django的modal对象保存后，自动触发</span></div><div class="line">    pre_delete                  <span class="comment"># django的modal对象删除前，自动触发</span></div><div class="line">    post_delete                 <span class="comment"># django的modal对象删除后，自动触发</span></div><div class="line">    m2m_changed                 <span class="comment"># django的modal中使用m2m字段操作第三张表（add,remove,clear）前后，自动触发</span></div><div class="line">    class_prepared              <span class="comment"># 程序启动时，检测已注册的app中modal类，对于每一个类，自动触发</span></div><div class="line">Management signals</div><div class="line">    pre_migrate                 <span class="comment"># 执行migrate命令前，自动触发</span></div><div class="line">    post_migrate                <span class="comment"># 执行migrate命令后，自动触发</span></div><div class="line">Request/response signals</div><div class="line">    request_started             <span class="comment"># 请求到来前，自动触发</span></div><div class="line">    request_finished            <span class="comment"># 请求结束后，自动触发</span></div><div class="line">    got_request_exception       <span class="comment"># 请求异常后，自动触发</span></div><div class="line">Test signals</div><div class="line">    setting_changed             <span class="comment"># 使用test测试修改配置文件时，自动触发</span></div><div class="line">    template_rendered           <span class="comment"># 使用test测试渲染模板时，自动触发</span></div><div class="line">Database Wrappers</div><div class="line">    connection_created          <span class="comment"># 创建数据库连接时，自动触发</span></div></pre></td></tr></table></figure>
<p>对于Django内置的信号，仅需注册指定信号，当程序执行相应操作时，自动触发注册函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_finished</div><div class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_started</div><div class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> got_request_exception</div><div class="line"></div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> class_prepared</div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_init, post_init</div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_save, post_save</div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_delete, post_delete</div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> m2m_changed</div><div class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_migrate, post_migrate</div><div class="line"></div><div class="line"><span class="keyword">from</span> django.test.signals <span class="keyword">import</span> setting_changed</div><div class="line"><span class="keyword">from</span> django.test.signals <span class="keyword">import</span> template_rendered</div><div class="line"></div><div class="line"><span class="keyword">from</span> django.db.backends.signals <span class="keyword">import</span> connection_created</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(sender, **kwargs)</span>:</span></div><div class="line">    print(<span class="string">"xxoo_callback"</span>)</div><div class="line">    print(sender,kwargs)</div><div class="line"></div><div class="line">xxoo.connect(callback)</div><div class="line"><span class="comment"># xxoo指上述导入的内容</span></div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_finished</div><div class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</div><div class="line"></div><div class="line"><span class="meta">@receiver(request_finished)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback</span><span class="params">(sender, **kwargs)</span>:</span></div><div class="line">    print(<span class="string">"Request finished!"</span>)</div></pre></td></tr></table></figure>
<h4 id="2、自定义信号"><a href="#2、自定义信号" class="headerlink" title="2、自定义信号"></a>2、自定义信号</h4><h5 id="a-定义信号"><a href="#a-定义信号" class="headerlink" title="a. 定义信号"></a>a. 定义信号</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> django.dispatch</div><div class="line">pizza_done = django.dispatch.Signal(providing_args=[<span class="string">"toppings"</span>, <span class="string">"size"</span>])</div></pre></td></tr></table></figure>
<h5 id="b-注册信号"><a href="#b-注册信号" class="headerlink" title="b. 注册信号"></a>b. 注册信号</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(sender, **kwargs)</span>:</span></div><div class="line">    print(<span class="string">"callback"</span>)</div><div class="line">    print(sender,kwargs)</div><div class="line"> </div><div class="line">pizza_done.connect(callback)</div></pre></td></tr></table></figure>
<h5 id="c-触发信号"><a href="#c-触发信号" class="headerlink" title="c. 触发信号"></a>c. 触发信号</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> 路径 <span class="keyword">import</span> pizza_done</div><div class="line"> </div><div class="line">pizza_done.send(sender=<span class="string">'seven'</span>,toppings=<span class="number">123</span>, size=<span class="number">456</span>)</div></pre></td></tr></table></figure>
<p>由于内置信号的触发者已经集成到Django中，所以其会自动调用，而对于自定义信号则需要开发者在任意位置触发。</p>
<p>更多：<a href="https://docs.djangoproject.com/en/dev/topics/signals/" target="_blank" rel="external">猛击这里</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://7u2o1q.com1.z0.glb.clouddn.com/webchat-reward.jpg" alt="Yaro WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://7u2o1q.com1.z0.glb.clouddn.com/alipay-reward.jpg" alt="Yaro Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/15/第12篇-Django初级篇/" rel="next" title="第12篇-Django初级篇">
                <i class="fa fa-chevron-left"></i> 第12篇-Django初级篇
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/15/Git使用过程/" rel="prev" title="Git使用过程">
                Git使用过程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/07/15/第12篇-Django进阶篇/"
           data-title="第12篇-Django进阶篇" data-url="http://yoursite.com/2017/07/15/第12篇-Django进阶篇/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7u2o1q.com1.z0.glb.clouddn.com/Yaro%E5%A4%B4%E5%83%8F1.png"
               alt="Yaro" />
          <p class="site-author-name" itemprop="name">Yaro</p>
          <p class="site-description motion-element" itemprop="description">生活=不断尝试,不断犯错</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">30</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yaro97" target="_blank" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/wyzh97" target="_blank" title="Twitter">
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/mryaro" target="_blank" title="知乎">
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Model"><span class="nav-number">1.</span> <span class="nav-text">Model</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、创建表"><span class="nav-number">1.1.</span> <span class="nav-text">一、创建表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、基本结构"><span class="nav-number">1.1.1.</span> <span class="nav-text">1、基本结构</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#字段"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">字段</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#参数"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#元信息"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">元信息</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#拓展知识"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">拓展知识</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、连表结构"><span class="nav-number">1.1.2.</span> <span class="nav-text">2、连表结构</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#字段以及参数"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">字段以及参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、操作表"><span class="nav-number">1.2.</span> <span class="nav-text">二、操作表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1、基本操作"><span class="nav-number">1.2.1.</span> <span class="nav-text">1、基本操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2、进阶操作（了不起的双下划线）"><span class="nav-number">1.2.2.</span> <span class="nav-text">2、进阶操作（了不起的双下划线）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3、其他操作"><span class="nav-number">1.2.3.</span> <span class="nav-text">3、其他操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4、连表操作（了不起的双下划线）"><span class="nav-number">1.2.4.</span> <span class="nav-text">4、连表操作（了不起的双下划线）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Form"><span class="nav-number">2.</span> <span class="nav-text">Form</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跨站请求伪造"><span class="nav-number">3.</span> <span class="nav-text">跨站请求伪造</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、简介"><span class="nav-number">3.1.</span> <span class="nav-text">一、简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、应用"><span class="nav-number">3.2.</span> <span class="nav-text">二、应用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Cookei"><span class="nav-number">4.</span> <span class="nav-text">Cookei</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、获取Cookie："><span class="nav-number">4.1.</span> <span class="nav-text">1、获取Cookie：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、设置Cookie："><span class="nav-number">4.2.</span> <span class="nav-text">2、设置Cookie：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Session"><span class="nav-number">5.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分页"><span class="nav-number">6.</span> <span class="nav-text">分页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一、Django内置分页"><span class="nav-number">6.1.</span> <span class="nav-text">一、Django内置分页</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#二、自定义分页"><span class="nav-number">6.2.</span> <span class="nav-text">二、自定义分页</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存"><span class="nav-number">7.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、配置"><span class="nav-number">7.1.</span> <span class="nav-text">1、配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a、开发调试"><span class="nav-number">7.1.1.</span> <span class="nav-text">a、开发调试</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b、内存"><span class="nav-number">7.1.2.</span> <span class="nav-text">b、内存</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c、文件"><span class="nav-number">7.1.3.</span> <span class="nav-text">c、文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#d、数据库"><span class="nav-number">7.1.4.</span> <span class="nav-text">d、数据库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#e、Memcache缓存（python-memcached模块）"><span class="nav-number">7.1.5.</span> <span class="nav-text">e、Memcache缓存（python-memcached模块）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#f、Memcache缓存（pylibmc模块）"><span class="nav-number">7.1.6.</span> <span class="nav-text">f、Memcache缓存（pylibmc模块）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、应用"><span class="nav-number">7.2.</span> <span class="nav-text">2、应用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a-全站使用"><span class="nav-number">7.2.1.</span> <span class="nav-text">a. 全站使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b-单独视图缓存"><span class="nav-number">7.2.2.</span> <span class="nav-text">b. 单独视图缓存</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c、局部视图使用"><span class="nav-number">7.2.3.</span> <span class="nav-text">c、局部视图使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#序列化"><span class="nav-number">8.</span> <span class="nav-text">序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、serializers"><span class="nav-number">8.1.</span> <span class="nav-text">1、serializers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、json-dumps"><span class="nav-number">8.2.</span> <span class="nav-text">2、json.dumps</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#信号"><span class="nav-number">9.</span> <span class="nav-text">信号</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1、Django内置信号"><span class="nav-number">9.1.</span> <span class="nav-text">1、Django内置信号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2、自定义信号"><span class="nav-number">9.2.</span> <span class="nav-text">2、自定义信号</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#a-定义信号"><span class="nav-number">9.2.1.</span> <span class="nav-text">a. 定义信号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b-注册信号"><span class="nav-number">9.2.2.</span> <span class="nav-text">b. 注册信号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#c-触发信号"><span class="nav-number">9.2.3.</span> <span class="nav-text">c. 触发信号</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yaro</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yaro97githubio"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
